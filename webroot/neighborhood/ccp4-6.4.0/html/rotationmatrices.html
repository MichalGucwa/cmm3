<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>CCP4 Program Suite - GENERAL DOCUMENTATION - Rotation Matrices</title>
<link rev="made" href="mailto:mgwt@ysbl.york.ac.uk (Maria Turkenburg)" />
</head>
<body>

<!-- ::INDEX_INFO::rotationmatrices::General::Rotation Matrices::on Eulerian angles, polar angles and direction cosines, and orthogonalisation codes:::::: -->

<h1>Rotation Matrices (CCP4: General)</h1>
<h2>NAME</h2>
<p>rotationmatrices - on Eulerian angles, polar angles and direction cosines, and orthogonalisation codes</p>

<h3>Contents</h3>

<ul>
  <li><a href="#general_remarks">General Remarks</a>
  <li><a href="#orthogonalisation_codes">Orthonormal Axes, and Orthogonalisation Codes</a>
  <li><a href="#polar_angles">Polar Angles</a>
  <li><a href="#eulerian_angles">Eulerian Angles</a>
</ul>

<a name="general_remarks"></a>
<h3>General Remarks</h3>

<p>A rotation matrix is a matrix which moves a  body as a rigid unit without altering its internal geometry.
It is defined as a 3 X 3 matrix which when multiplied by a vector has the effect of changing the direction of
the vector but not its magnitude (adapted from: <a href="http://en.wikipedia.org/wiki/Rotation_matrix">Rotation matrix in Wikipedia</a>).</p>

<p>A molecule is a body described by a set of coordinates, each of which is equivalent to a vector from the origin to that atom.
If all the coordinates are rotated by the same matrix, the new rotated set can be generated by applying this equation to each
coordinate of the original model:</p>
<blockquote><pre>[Xrot]    = [ROT] [Xorig]
[Yrot]            [Yorig]
[Zrot]            [Zorig]

where [ROT] = [ R11 R12 R13 ]
              [ R21 R22 R23 ]
              [ R31 R32 R33 ]</pre></blockquote>

<p>Such a rotation can be fully described by only three parameters.
For example if we know the direction of the rotation axis relative to some fixed axes, and the amount of
the rotation about this axis, then the rotation matrix is defined. This method is called that of Polar angles.
Another way of describing the rotation is to rotate the model 3 times in succession about any 3 non-planar
directions. This method is called that of Eulerian angles.
Whatever way the rotation is described, each must generate the same rotation matrix, and any
set of descriptors can be converted to any other using the appropriate equations.</p>

<h3><a name="orthogonalisation_codes"></a>Orthonormal Axes, and Orthogonalisation Codes</h3>

<p>It is very complicated to write down the form of the rotation matrix when rotations are
performed relative to general axes.
In practice we always define these rotations relative to axes which are orthonormal, <em>i.e.</em> perpendicular
to each other and of equal length.
The coordinates must also be given relative to these axes, which in general are not the crystallographic axes.</p>

<p>A system is orthogonal if its vectors are pairwise orthogonal (<em>i.e.</em> perpendicular).
See <a href="http://en.wikipedia.org/wiki/Orthogonal_matrix">orthogonal matrix</a> and
<a href="http://en.wikipedia.org/wiki/Orthonormal_basis">orthonormal basis</a>.
A basis is orthonormal, or unitary, if it is orthogonal and all vectors have unit length (from:
<a href="http://www.mathreference.com/la,orth.html">Math Reference - Karl Dahlke</a>).</p>

<p>In the PDB, the default orthogonal system for a crystal has the Xortho  axis, (X<sub>o</sub>), along the crystallographic a-axis,
the Zortho axis, (Z<sub>o</sub>), along the crystallographic c*,
and the Yortho axis, (Y<sub>o</sub>), along the direction completing the system (c* x a).
Other orthogonalisation conventions used occasionally are given below. It is sometimes necessary to
interconvert between conventions and  CCP4 programs refer to the different systems using a variable NCODE.</p>

<blockquote><table border="1">
<tr><th>NCODE</th><th>orthogonal x y z along</th><th>remark</th></tr>
<tr><td>1</td><td>a, c*×a, c*</td><td>Brookhaven, default</td></tr>
<tr><td>2</td><td>b, a*×b, a*</td><td></td></tr>
<tr><td>3</td><td>c, b*×c, b*</td><td></td></tr>
<tr><td>4</td><td>a+b, c*×(a+b), c*</td><td></td></tr>
<tr><td>5</td><td>a*, c×a*, c</td><td>Rollett</td></tr>
<tr><td>6</td><td>a, b*, a×b*</td><td></td></tr>
<tr><td>7</td><td>a*, b, a*×b</td><td>TNT</td></tr>
</table></blockquote>

<h3><a name="polar_angles"></a>Polar Angles</h3>

<p>The CCP4 convention is to define the direction of the axis about which the rotation &#954; (kappa)
takes place using the direction cosines (l m n) where</p>
<blockquote><pre>( l )    ( sin&#969; cos&#981; )
( m )  = ( sin&#969; sin&#981; )
( n )    ( cos&#969; )</pre></blockquote>

<p>Thus &#969; is the angle the rotation axis makes to the Z<sub>o</sub> direction (<em>i.e.</em> from
the pole), and &#981; is the angle the projection of the rotation axis onto the
X<sub>o</sub>-Y<sub>o</sub>-plane (<em>i.e.</em> the equatorial plane) makes to
the X<sub>o</sub>-axis.</p>

<p>Since direction cosines are the cosines of the angles a vector makes with the positive axes of
an orthogonal system, they obey l<sup>2</sup> + m<sup>2</sup> + n<sup>2</sup> = 1.</p>

<p>Then:</p>
<blockquote><pre>[ROT] = ( l<sup>2</sup>+(m<sup>2</sup>+n<sup>2</sup>)cos&#954;          lm(1-cos&#954;)-nsin&#954;        nl(1-cos&#954;)+msin&#954; )
        ( lm(1-cos&#954;)+nsin&#954;        m<sup>2</sup>+(l<sup>2</sup>+n<sup>2</sup>)cos&#954;          mn(1-cos&#954;)-lsin&#954; )
        ( nl(1-cos&#954;)-msin&#954;        mn(1-cos&#954;)+lsin&#954;        n<sup>2</sup>+(l<sup>2</sup>+m<sup>2</sup>)cos&#954;   )</pre></blockquote>

<p>This can also be visualised as
rotation &#981; about Z,
rotation &#969; about the new Y,
rotation &#954; about the new Z,
rotation (-&#969;) about the new Y,
rotation (-&#981;) about the new Z.</p>

<p>Note that the rotation matrix generated from (&#969;,&#981;,&#954;) is identical to that generated from
(&#960;-&#969;,&#960;+&#981;,-&#954;) so it is conventional to restrict &#954; to range: 0 to &#960;.</p>
<p>Also note that if &#969; = 0 or 180, then &#981; is indeterminate.</p>
<p>And note that in some conventions, &#968; is used instead of &#969;, and &#967; instead of &#954;.</p>

<p>It is often convenient in crystallography to present the Polar angles in sections of &#954;.
For instance, if it is suspected that the crystal could contain a multimer such as a dimer, trimer,
tetramer, pentamer, <em>etc.</em>,
then there would be a large self rotation peak at &#954; = 180, 120, 90, 72 respectively.</p>

<h3><a name="eulerian_angles"></a>Eulerian Angles</h3>

<p>A rotation can be uniquely defined by rotating the rigid body 3 times in succession about any
3 non-planar directions. These rotation angles are called the Eulerian angles.</p>

<p>All CCP4 programs define these in the following way (described in early papers by Tony Crowther):
(&#945;,&#946;,&#947;) are the Eulerian angles which rotate the coordinates of crystal 2 (the model)
 first through &#947; about the initial Z-axis, then through &#946; about the new position
of the Y-axis, then through &#945; about the final Z-axis. Positive rotation is clockwise when looking along the
axis from the origin.  The rotations are carried out in the orthogonal frame, which is related to the crystallographic frame according
to the setting of the <a href="#orthogonalisation_codes">ORTH flag</a>. Beware of the permutations introduced by ORTH &#8800; 1. Schematically:</p>

<blockquote><pre>[ROT] = [ROT]<sub>&#945;</sub> * [ROT]<sub>&#946;</sub> * [ROT]<sub>&#947;</sub>

        [cos&#945;   -sin&#945;   0]   [ cos&#946;   0   sin&#946;]   [cos&#947;   -sin&#947;   0]
      = [sin&#945;    cos&#945;   0] * [    0   1      0] * [sin&#947;    cos&#947;   0]
        [   0       0   1]   [-sin&#946;   0   cos&#946;]   [   0       0   1]

        [ cos&#945; cos&#946; cos&#947; - sin&#945; sin&#947;     -cos&#945; cos&#946; sin&#947; - sin&#945; cos&#947;     cos&#945; sin&#946; ]
      = [ sin&#945; cos&#946; cos&#947; + cos&#945; sin&#947;     -sin&#945; cos&#946; sin&#947; + cos&#945; cos&#947;     sin&#945; sin&#946; ]
        [ -sin&#946; cos&#947;                     sin&#946; sin&#947;                       cos&#946;      ]</pre></blockquote>

<p>Note that the rotation matrix generated from (&#945;,&#946;,&#947;) is identical to that
generated from (&#960;+&#945;,-&#946;,&#960;+&#947;) so it is conventional to restrict &#946; to range: 0 to &#960;.</p>
<p>This description of the rotation is equivalent to keeping the coordinates fixed and rotating the AXES [I,J,K] first through &#945;, then through
&#946;, then through &#947;.</p>

<blockquote><pre>[ I<sub>o</sub>  J<sub>o</sub>  K<sub>o</sub> ][XO1]    = [ I<sub>o</sub>  J<sub>o</sub>  K<sub>o</sub> ] [ROT] [XO2]
              [YO1]                          [YO2]
              [ZO1]                          [ZO2]

where [ROT] = [ R11 R12 R13 ]
              [ R21 R22 R23 ]
              [ R31 R32 R33 ]</pre></blockquote>
 
<p><a href="acorn.html">ACORN</a>,
<a href="amore.html">AMoRe</a>,
<a href="molrep.html">MOLREP</a>,
<a href="phaser.html">PHASER</a>,
<a href="almn.html">ALMN</a>,
<a href="lsqkab.html">LSQKAB</a>,
<a href="pdbset.html">PDBSET</a> and
<a href="dm.html">'<tt>dm</tt>'</a> use Eulerian angles in this convention to define the rotation matrices. There are various
programs for interconverting between Euler angles, polar angles and direction cosines.</p>

<p>From rotmat.html:</p>
<pre> Rotation matrices to PREMULTIPLY coordinate columns or POSTMULTIPLY axis rows vectors are defined as follows:

      Using Eulerian angles ALPHA BETA GAMMA (CCP4/MERLOT) relative to orthogonal axes (I J K) and defining [R] as the product of:

        Rotation 1 (ALPHA) about K         :  [R]alpha
        Rotation 2 (BETA)  about the new J :  [R]beta
        Rotation 3 (GAMMA) about the new K :  [R]gamma

    (and abbreviating cos(ALPHA) = CA; sin(BETA) = SB etc)

       [ R11 R12 R13 ]
       [ R21 R22 R23 ]  =  [ R]alpha * [R]beta * [R]gamma 
       [ R31 R32 R33 ]
                           [CA -SA 0] [ CB 0 SB] [CG -SG 0]
                        =  [SA  CA 0]*[  0 1  0]*[SG  CG 0] 
                           [ 0   0 1] [-SB 0 CB] [ 0   0 1]

      ( CA CB CG - SA SG      -CA CB SG - SA CG      CA SB )
    = ( SA CB CG + CA SG      -SA CB SG + CA CG      SA SB )
      (         -SB CG                  SB SG           CB )

          Note that the rotation matrix generated from (ALPHA,BETA,GAMMA) is identical to that
          generated from (PI+ALPHA,-BETA,PI+GAMMA) so it is conventional to restrict BETA to range: 0 to PI 
          If you think of coordinates as vector products of the row vector of the AXES by the column vector of orthogonal coordinates

                             [ I J K] * [ X0]
                                        [ Y0]
                                        [ Z0]

          and a rotation matrix [R] as moving these to

                       [ I J K] * [R] * [ X0]
                                        [ Y0]
                                        [ Z0]

          then it is obvious that rotation [R] can be seen either
          as rotating the axes [I J K ] by ALPHA then BETA then GAMMA or
          as rotating coordinates [X0] by -GAMMA then -BETA then -ALPHA. 
</pre>

<h2>SEE ALSO</h2>
<a href="acorn.html">ACORN</a>,
<a href="almn.html">ALMN</a>,
<a href="amore.html">AMoRe</a>,
<a href="dm.html">'<tt>dm</tt>'</a>,
<a href="lsqkab.html">LSQKAB</a>,
<a href="maprot.html">MAPROT</a>,
<a href="pdbcur.html">PDBCUR</a>,
<a href="pdbset.html">PDBSET</a>,
<a href="polarrfn.html">POLARRFN</a>,
<a href="rotmat.html">ROTMAT</a>.
<h2>AUTHORS</h2>
<p>Maria Turkenburg and Eleanor Dodson, University of York, England<br />
Prepared for CCP4 by Maria Turkenburg</p>
</body>
</html>
