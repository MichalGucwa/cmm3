<html>
<head><title>CCP4 Program Suite: libhtml</title></head>
<body>

<!-- ::INDEX_INFO::LIBHTML::Library::::Subroutine Library for inserting html tags into log files:::::::: -->

<H1> LIBHTML (CCP4: Library)</H1>
<H2> NAME</H2>
<b>libhtml </b>
- Subroutine Library for inserting HTML tags into log files
<H2> DESCRIPTION</H2>

<p>These are Kevin Cowtan's routines (with subsequent modifications by
Sheila Peters, Alun Ashton, Martyn Winn and Peter Briggs) for inserting HTML
tags into  log files so that they can be viewed through a HTML browser. The
functionality includes:</p>

<ul>
  <li> Linking keywords to documentation, through keyparser
  <li> Creating a table of contents with internal links, to make
       navigation of the log file easier
  <li> A Java applet which gives Xloggraph-style ability to view
       graphs in tables, embedded into the log file.
  <li> Identifying important output for subsequent extraction into
       a summary log file.
</ul>

<p>Some basic knowledge of HTML tags is assumed, and we recommend those who
wish to learn to look at one of the large number of on-line references for
HTML which can easily be found through any internet search engine. In
particular programmers should be aware that log files which are intended to
be viewed as HTML should avoid the use of <a href="#reserved_chars">reserved
HTML characters</a> which may confuse the HTML browser.</p>

<H2>Overview</H2>

<p>These routines provide basic tools for inserting HTML formatting tags into
CCP4 log files to enable them to be viewed through a HTML browser. The
advantages include the ability to link text within the log file to resources
either in the same or in a different document, for example a set of parameters
generated by a program and printed to the log file might be linked to a
relevant section in the program documentation.</p>

<p>In the subroutine descriptions below, the following terminology is used.
<b>link text</b> refers to text which will be visible to read by the
person viewing the log file, and which is hyperlinked to other text (either
in the same file or in a different one) denoted by the <b>link destination</b>
i.e. clicking on the link text will cause the browser to jump to another
bit of documentation.</p>

<p>The <b>link destination</b> can be another file, or it can be a point in the
current file (in which case the link destination will start with a hash symbol
"#").</p>

<p>The calling sequence should start with a call to
<a href="#ccp4h_init">ccp4h_init</a>, which writes an initial comment to the log
file and initialises the internal variables which will be used by the other
routines.</p>

<p>A table of contents can be generated with a call to
<a href="#ccp4h_toc_beg">ccp4h_toc_beg</a> to begin the contents list (and write
the title "Contents" to the log file). Each entry in the contents list requires
a call to <a href="#ccp4h_toc_ent">ccp4h_toc_ent</a>, which creates a link to
other text (if the link destinations are to be in the log file then calls to
<a href="#ccp4h_header">ccp4h_header</a> will need be made at appropriate
points, corresponding to each entry in the contents list). Once all the entries
have been written, the contents list must be closed by a call to
<a href="#ccp4h_toc_end">ccp4h_toc_end</a>.</p>

<p>Graphs can be embedded in the log file so that they are displayed
using a java applet (provided that the appropriate Java class files are available
to the browser - see <a href="#associated_files">Associated files</a>). A call
to <a href="#ccp4h_graph_beg">ccp4h_graph_beg</a>
is followed by the table/graph information (in the usual loggraph format)
and then closed immediately by a call to
<a href="#ccp4h_graph_end">ccp4h_graph_end</a>.</p>

<p>Preformatted text can be enclosed by the appropriate tags by calling
<a href="#ccp4h_pre_beg">ccp4h_pre_beg</a> and <a href="#ccp4h_pre_end">ccp4h_pre_end</a>
immediately before and immediately after respectively the text which is to be
displayed in this way. This is useful for any information in which spacing is
important, for example graphs generated using ascii characters (but see the
<a href="#pre_notes">notes</a> below).</p>

<p><a href="#ccp4h_rule">ccp4h_rule</a> will generate a horizontal line in the
html log file. The routines <a href="#ccp4h_link">ccp4h_link</a> and
<a href="#ccp4h_link_key">ccp4h_link_key</a> are used to create links, and
<a href="#ccp4h_header">ccp4h_header</a> to create destinations for links within
the log file.</p>

<p>The routines <a href="#ccp4h_summary_beg">ccp4h_summary_beg</a> and
<a href="#ccp4h_summary_end">ccp4h_summary_end</a> can be used to delimit
important output that should be included in a summary log file. These functions
can be called whether or not the log file is to be in HTML, and whether or
not <a href="#ccp4h_init">ccp4h_init</a> has been called. The summary text
is bounded by identifying tags in the form of an HTML comment string, and separate
tools (e.g. the simple awk script 
<tt>awk '/SUMMARY_BEGIN/,/SUMMARY_END/' | grep -v 'SUMMARY'</tt>) 
can be used to extract the summary text. If the log file is in HTML, then
the summary text is highlighted in the main file, and the summary file will
also be in HTML. Many of the main library routines have calls to the summary
routines, so all programs will produce some summary tags, but the summary
file will only be meaningful if additional calls are made from the program
itself.</p>

<H2>Description of Subroutines</H2>

<p>The subroutines have been divided into a number of different sections
depending on their function:</p>

<ol>
  <li><a href="#log_initialise">Initialisation of the html log file</a>
  <li><a href="#log_toc">Generating table of contents</a>
  <li><a href="#log_graphs">Embedding log graphs</a>
  <li><a href="#log_general">General html formatting</a>
    <ul>
      <li><a href="#preformatted_text">Preformatted text</a>
      <li><a href="#horizontal_rule">Horizontal rule</a>
      <li><a href="#creating_links">Creating links</a>
    </ul>
  <li><a href="#log_close">End of html log file</a>
  <li><a href="#log_summary">Delimiting summary sections</a>
</ol>

<a name="log_initialise"></a>
<H3>1. Initialisation</H3>

<dl>
<a name="ccp4h_init_lib"></a>
<dt>ccp4h_init_lib(int ihtml, int isumm) - initialises COMMON block variables
   <dd> <p>On the first call, this initialises some COMMON block variables.
        This is called from CCPFYP and MTZINI, so should not need to be
        called from the program.
	<pre>
	ihtml = (input) -1 : suppress printing of HTML tags
	                 0 : activate HTML tags
        isumm = (input) -1 : suppress printing of summary tags
	                 0 : activate summary tags
	</pre>
</p>
<a name="ccp4h_init"></a>
<dt>ccp4h_init() - write initial comment to identify file
   <dd> <p>This writes an initial &lt;html&gt; tag and a comment to the 
        log file and sets some variables used by the other subroutines.
        This routine effectively activates the writing of an HTML log
        file, unless the environment variable 
        <a href="#environment_variables">CCP_SUPPRESS_HTML</a> (and/or
	the command line option <b>-nohtml</b>) is set,
        in which case HTML output is suppressed.</p>
</dl>

<a name="log_toc"></a>
<H3>2. Table of contents</H3>

<dl>
<a name="ccp4h_toc_beg"></a>
<dt>ccp4h_toc_beg() - write starting Contents section tags
   <dd> <p>This is used to start a table of contents, by writing the
        title "Contents" and then the opening tag &lt;ul&gt; for an
        unordered list.</p>

<a name="ccp4h_toc_ent"></a>
<dt>ccp4h_toc_ent(char*(*) text, char*(*) dest) - write Contents entry
   <dd> <p>This is used to write an entry into the contents list. It adds
        a list item (&lt;li&gt;) and a link to another section.<br>
        text = the link text<br>
        dest = the link destination<br>
        The destination can be added using a call to
        <a href="#ccp4h_header">ccp4h_header</a> later in the program.</p> 

<a name="ccp4h_toc_end"></a>
<dt>ccp4h_toc_end() - write ending Contents section tags
   <dd> <p>Terminates the contents table by writing the close tag
        &lt;/ul&gt; for the unordered list.</p>
</dl>

<a name="log_graphs"></a>
<H3>3. Loggraph generation</H3>

<dl>
<a name="ccp4h_graph_beg"></a>
<dt>ccp4h_graph_beg(x,y) - write starting JLogGraph applet tag
   <dd> <p>Sets up the code for generating a log graph.<br>
        x = width of the graph in pixels<br>
        y = height of the graph in pixels<br>
        These set dimensions of the graph applet as it will
        appear in the log file when viewed through a browser.
        If both x and y are zero then they default to 400x300.</p>

<a name="ccp4h_graph_end"></a>
<dt>ccp4h_graph_end() - write ending JLogGraph applet tag
   <dd> <p>Closes the tag.</p>
</dl>

<P>NB: The log-graph generation requires that the files JLogGraph.class
and JLogCanvas.class be present in $CBIN. See the section on
<a href="#associated_files">Associated files</a> for more details.</P>

<a name="log_general"></a>
<H3>4. General HTML formatting</H3>

<a name="preformatted_text"></a>
<H4>4.1. Preformatted text:</H4>

<dl>
<a name="ccp4h_pre_beg"></a>
<dt>ccp4h_pre_beg() - begin preformatted (html &lt;pre&gt; tag)
   <dd> Marks the start of preformatted text (non-proportional
        spacing) eg for ascii maps of solvent masks.<p>

<a name="ccp4h_pre_end"></a>
<dt>ccp4h_pre_end() - end preformatted (html &lt;pre&gt; tag)
   <dd> Marks the end of preformatted text.
</dl>

<a name="pre_notes"></a><H4>Notes on the use of &lt;pre&gt; tags</H4>

<p>Within Netscape (and probably in other html browsers) it is necessary
to use a &lt;pre&gt; tag at the head of the log file output. This
effectively puts the whole log file inside a single &lt;pre&gt; "environment",
and is necessary for carriage returns within the file to be recognised
as such. Otherwise, any text not enclosed by header tags is run into
a single unformatted "paragraph".</p>

<p>Within this environment the browser should use a fixed-width font, so
that ascii tables formatted in the text should have their format preserved
(i.e. columns will still line up) when viewed in the browser.</p>

<p>However, there appears to be a bug in &lt;pre&gt; tags within Netscape: the
presence of other tags modifies the font, switching it to a proportionally
spaced one and thus causing the mis-alignment of ascii tables and other
formatted text.</p>

<p>There is no fix for this at present - the workaround is to make a call
to <tt>ccp4h_pre_beg</tt> immediately before the table etc. is to be written
out, but then not to close the &lt;pre&gt; environment (i.e. don't call
<tt>ccp4h_pre_end</tt>) until the very end of the logfile.</p>

<a name="horizontal_rule"></a>
<H4>4.2. Horizontal rule:</H4>

<dl>
<a name="ccp4h_rule"></a>
<dt>ccp4h_rule() - rule (html &lt;hr&gt; tag)
   <dd> Inserts a horizontal line across the width of the page when
        viewed through a browser.
</dl>

<a name="creating_links"></a>
<H4>4.3. Creating links:</H4>

<dl>
<a name="ccp4h_link"></a>
<dt>ccp4h_link(char*(*) text, char*(*) dest) - link (html &lt;a&gt; tag)
   <dd> <p>Creates a link to either another document, or (if the destination
        starts with the hash symbol "#") to another point in the current
        log file created using <a href="#ccp4h_header">ccp4h_header</a>.<br>
        text = the link text<br>
        dest = the link destination<br>
        If dest is not an anchor name (i.e. doesn't begin with a "#"), then
        the $CHTML path is prefixed automatically.</p>

<a name="ccp4h_link_key"></a>
<dt>ccp4h_link_key(char*(*) text, char*(*) dest) - link to CCP4 documentation
   <dd> <p>Creates a link to the CCP4 documentation for a program keyword.
        NB. this routine is for the very specific task of creating links for
        keywords in the input file to the documentation, and can only be used
        if keyparser is being used to interpret the keyworded input. For other
        types of link, use <a href="#ccp4h_link">ccp4h_link</a>.<br>
        text = the keyparser keyword<br>
        dest = the link destination filename and anchor, the $CHTML path
               is prefixed automatically.<br>
        Between call memoparse(.false.) and the main keyparser
        processing, call this routine with any keywords and links which
        should be linked to the program documentation. Then call parsefail()
        to restart syntax checking, e.g:
        <pre>
          call memoparse(.false.)
          call ccp4h_link_key('LABIN   ','fft.html#labin')
          call ccp4h_link_key('GRID    ','fft.html#grid')
          call ccp4h_link_key('FFTSPGRP','fft.html#fftspgrp')
          call parsefail()
        </pre></p>

<a name="ccp4h_header"></a>
<dt>ccp4h_header(char*(*) text, char*(*) name, int level) - header
   <dd> <p>Creates an "anchor" in the current log file which can be linked
        to using ccp4h_link.<br>
        text = the link text<br>
        name = header name to link to<br>
        level = 0 to 6, defines the header size (0 gives plain text).</p>
</dl>

<a name="log_close"></a>
<H3>5. End of html log file</H3>

<dl>
<a name="ccp4h_html_close"></a>
<dt>ccp4h_html_close() - write closing &lt;/html&gt; tag
   <dd> <p>This writes the closing &lt;/html&gt; tag. It is called
        by the library routine CCPERR for error levels 0 and 1, which
        should be the normal route for terminating a program. </p>
</dl>

<a name="log_summary"></a>
<H3>6. Delimiting summary sections</H3>

These routines insert tags for marking up areas of the logfile
to be included in a summary file, unless the environment variable 
<a href="#environment_variables">CCP_SUPPRESS_SUMMARY</a> (and/or
the command line option <b>-nosummary</b>) is set,
in which case summary tag output is suppressed.

<dl>
<a name="ccp4h_summary_beg"></a>
<dt>ccp4h_summary_beg() - begin summary section
   <dd> <p>Writes the line &lt;!--SUMMARY_BEGIN--&gt; at the beginning
           of a summary section. In HTML mode, also writes 
           &lt;B&gt;&lt;FONT COLOR="#FF0000"&gt;</p>
<a name="ccp4h_summary_end"></a>
<dt>ccp4h_summary_end() - end summary section
   <dd> <p>Writes the line &lt;!--SUMMARY_END--&gt; at the beginning
           of a summary section. In HTML mode, also writes 
           &lt;/B&gt;&lt;/FONT&gt;</p>
</dl>

<a name="associated_files"></a>
<H2>Associated files</H2>

<p>There are currently three associated files:</p>

<dl>
<dt>JLogGraph.java
  <dd>Java source code for applets to display the log graphs
<dt>JLogGraph.class
  <dd>Compiled java generated from JLogGraph.java
<dt>JLogGraph.class
  <dd>Compiled java generated from JLogGraph.java
</dl>

<p>These all reside initially in the $CPROG directory; executing "make install" at
installation will cause the executable .class files to be copied to the local
$CBIN directory.</p>

<p>Note that since Java is platform independent, there is no need to recompile
the .class files for different machines. However, the $CBIN directory must be
accessible to the browser in order for any log graphs to be displayed.</p>

<a name="environment_variables"></a>
<H2>Environment variables</H2>
<dl>
<dt>CBIN
  <dd>This is normally set by ccp4.setup and is used here to define the
      codebase for the applet which uses JLogGraph.class
<dt>CHTML
  <dd>This is normally set by ccp4.setup and is used here to define the
      location of documents in external links, typically the CCP4 
      documentation.
<dt>CCP_PROGRAM_ID
  <dd>The contents of the environment variable CCP_PROGRAM_ID are concatenated
      to the end of each link name. This allows multiple runs of a single 
      program from a script to be combined in one file without the links
      conflicting, by setting CCP_PROGRAM_ID separately for each run.
<dt>CCP_SUPPRESS_HTML
  <dd>If this is non-blank, output of HTML tags is suppressed. This is for
      the benefit of devotees of plain text.
<dt>CCP_SUPPRESS_SUMMARY
  <dd>If this is non-blank, output of summary tags is suppressed. This is for
      the benefit of devotees of plain text.
</dl>

<a name="reserved_chars"></a>
<H2>Note on reserved HTML characters</H2>

<p>There are a number of special (or reserved) characters in HTML which will not be
displayed the same way in a browser as they would be in ascii format - most
importantly for mathematical purposes, the "less than" and "greater than" symbols
&lt; and &gt; which are used to delimit html tags. The appearance of these
characters in a html log file would confuse the browser and have unpredictable
results in terms of what would be visible to the user.</p>

<p>The following characters: &lt;, &gt;, &amp; should be avoided in html log files.
Possible solutions are: use plain English, e.g. writing explicitly "greater than",
use "psuedo fortran", e.g. .gt. for &gt;, or use the HTML code for these characters:</p>

<center>
<table noborder>
<tr>
  <th align=center>Symbol
  <th align=center>HTML code
<tr>
  <td align=center>&lt;
  <td align=center>&amp;lt;
<tr>
  <td align=center>&gt;
  <td align=center>&amp;gt;
<tr>
  <td align=center>&amp;
  <td align=center>&amp;amp;
</table>
</center>

<p>The HTML codes will be displayed as the appropriate symbol when the log file
is viewed in a browser, but will be harder to read if the log file is displayed
as pure ascii.

</html>
