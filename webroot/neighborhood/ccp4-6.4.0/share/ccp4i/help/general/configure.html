<!doctype html public "-//w3c//dtd html 3.2//en">
<html>
<head>
<title>CCP4 Interface: Configuring CCP4i</title>
<link rel="stylesheet" type="text/css" href="../ccp4idocs.css" title="CCP4i" />
<link rev="made" href="mailto:mgwt@ysbl.york.ac.uk" />
<meta name="GENERATOR" content="Mozilla/3.0Gold (X11; I; IRIX 6.2 IP22) [Netscape]" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="AUTHOR" content="Maria and Liz" />
</head>
<body>

<table border="0">
<tr><td rowspan="2"><img src="../images/weblogo175.gif" alt="CCP4 web logo" /></td>
<td class="logohead">CCP4i: Graphical User Interface</td></tr>
<tr><td class="logotitle">Configuring CCP4i to Use Local Resources</td></tr>
</table>
<br />
<table border="0">
<tr><td>
<a href="install.html" target="_PROGRAMMERSDOCS">
<img border="0" class="navbutton" src="../images/3Dnexttr.gif" alt="next button" /></a>
</td></tr>
</table>

<p><a href="#introduction" target="_self">Introduction</a></p>

<dl>
<dt><a href="#configure_ccp4i" target="_self"><strong>Configure CCP4i</strong></a></dt>
<dd><a href="#ccp4_setup_command" target="_self">CCP4 Setup Command</a></dd>
<dd><a href="#run_ccp4i" target="_self">Run CCP4i Command</a></dd>
<dd><a href="#mail" target="_self">Mail Address</a></dd>
<dd><a href="#blt_library" target="_self">The BLT Library</a></dd>
<dd><a href="#mtz_columns" target="_self">MTZ Column Label Display</a></dd>
<dd><a href="#lines_in_frame" target="_self">Frame Length For Logfile Display</a></dd>
</dl>

<dl>
<dt><a href="#ccp4i_utilities" target="_self"><strong>CCP4i Utilities</strong></a></dt>
<dd><a href="#loggraph" target="_self">Loggraph</a></dd>
<dd><a href="#mapslicer" target="_self">Mapslicer</a></dd>
<dd><a href="#topdraw" target="_self">Topdraw</a></dd>
<dd><a href="#ccp4mg" target="_self">CCP4mg</a></dd>
</dl>

<dl>
<dt><a href="#external_programs" target="_self"><strong>External Programs</strong></a></dt>
<dd><a href="#hypertext_viewer" target="_self">Viewing HTML Help Text</a></dd>
<dd><a href="#map_format_conversion" target="_self">Map File Format Conversion Options</a></dd>
<dd><a href="#modeller" target="_self">Options for running MODELLER</a></dd>
<dd><a href="#shelxs" target="_self">Running SHELXS</a></dd>
<dd><a href="#disable_tasks" target="_self">Disable tasks with missing programs</a></dd>
<dd><a href="#program_full_paths" target="_self">Full paths of programs</a></dd>
</dl>

<dl>
<dt><a href="#customize_colours" target="_self"><strong>Customize Joblist Colours</strong></a></dt>
</dl>

<dl>
<dt><a href="#help" target="_self"><strong>Help</strong></a></dt>
<dd><a href="#bubble_help" target="_self">Enabling Bubble Help</a></dd>
</dl>

<dl>
<dt><a href="#hardware_resources" target="_self"><strong>Hardware Resources</strong></a></dt>
<dd><a href="#remote_machine" target="_self">Running Jobs Remotely</a></dd>
<dd><a href="#batch_queues" target="_self">Batch Queues</a></p>
<dd><dl>
<dt><a href="#postscript_files" target="_self">Postscript Files</a></dt>
<dd><a href="#postscript_viewers" target="_self">Postscript Viewers</a></dd>
<dd><a href="#printers" target="_self">Printing Postscript
Files</a></dd>
</dl></dd>
</dl>

<dl>
<dt><a href="#network_resources" target="_self"><strong>Networked Resources</strong></a></dt>
<dd><a href="#proxy" target="_self">Proxy Server</a></dd>
<dd><a href="#sequence_database" target="_self">Sequence Database Retrieval Command</a></dd>
</dl>

<dl>
<dt><a href="#fonts" target="_self"><strong>Fonts</strong></a></dt>
</dl>

<dl>
<dt><a href="#testing" target="_self">Testing the Local Resources</a></dt>
<dd><a href="#test_loggraph" target="_self">BLT &amp; Printing</a></dd>
<dd><a href="#test_running_jobs" target="_self">Testing Running Jobs</a></dd>
</dl>

<p><a href="#saving_configuration" target="_self">Saving the Configuration Setup</a></p>

<p><a href="#sending_mail" target="_self">Sending Mail</a></p>

<h3><a name="introduction"></a>Introduction</h3>

<p>The Interface needs to be configured to make use of other non-CCP4 software
on your system and to provide easy access to hardware such as printers
and remote machines or batch queues.</p>

<p>The local resources are defined in the file
<strong>$CCP4I_top/etc/configure.def</strong> which can be edited using a graphical
utility accessed by the command:</p>

<p><strong>&gt; ccp4i -c[onfigure]</strong></p>

<p>It can also be accessed using the <tt>Configure Interface</tt> button on
the bottom right of the Main Window.</p>

<p>This will bring up a window similar to the Interface
task windows and you can enter the appropriate information for the parameters
described below. When you have finished you should save the information
to the installation file. There is also an option to save the information
to the user's home directory (as a file <strong>$HOME/.CCP4/unix/configure.def</strong>).
This option enables individual users to customise the system. Note that the
user's settings will over-ride the central settings.</p>

<h2><a name="configure_ccp4i"></a>Configure CCP4i</h2>

<h3><a name="ccp4_setup_command"></a>CCP4 Setup Command</h3>

<p>When the Interface runs a job remotely or in batch, it must setup the CCP4
program suite. You should enter the command that you use locally to do this.</p>

<h3><a name="run_ccp4i"></a>Run CCP4i Command</h3>

<p>This is the command used to run the scripts for a job. It should be
set to <strong>ccp4ish</strong>, there are currently no alternatives.</p>

<h3><a name="mail"></a>Mail Address</h3>

<p>The <strong><tt>Mail CCP4</tt></strong> option on the main window makes it easy to mail the program developer with questions or problems.  The mail address should be ccp4gui@dl.ac.uk</p>

<h3><a name="blt_library"></a>The BLT Library</h3>

<p>The <a href="loggraph.html" target="_MAIN">Loggraph Utility</a>
will generate Postscript plot files. It needs
to have access to resource files in the BLT library which in a standard
installation would be in the directory:<br />

/usr/local/library/blt2.4<br />

CCP4i will try to fill in the correct pathname for this the first time you open the Configure window.
If Loggraph can not find the appropriate resource files when attempting
to print out a plot, there will be an error message:</p>

<p><em>couldn't open prologue file</em></p>

<h3><a name="mtz_columns"></a>MTZ Column Label Display</h3>

<p>If an MTZ file contains a large number of columns of data, then it is
possible that the selection menu will be longer than the screen and some
columns will be inaccessible. To prevent this, menus of MTZ columns are
broken into several columns, with this option setting the maximum length of
each column in the  menu in terms of the number of MTZ labels.</p>

<h3><a name="lines_in_frame"></a>Frame Length For Logfile Display</h3>

<p>This sets the maximum number of lines of a logfile that CCP4i's built-in
logfile browser will display in a single "frame". Logfiles that exceed this
number of lines will be displayed as separate frames with this number of
lines.</p>

<h2><a name="ccp4i_utilities"></a>CCP4i Utilities</h2>

<h3><a name="loggraph"></a>Loggraph</h3>

<p>This is the command used to run the
<a href="loggraph.html" target="_MAIN">Loggraph Utility</a> for displaying
graphs and tables in CCP4 log files. It should be set to
<strong>loggraph</strong>.</p>

<h3><a name="mapslicer"></a>Mapslicer</h3>

<p>This is the command used to run the
<a href="../../../../html/mapslicer.html" target="_MAIN">Mapslicer Utility</a> for
displaying sections in CCP4 map and mask files. It should be set to
<strong>mapslicer</strong>.</p>

<h3><a name="topdraw"></a>TopDraw</h3>

<p>This is the command used to run the
<a href="../../../../html/topdraw.html" target="_MAIN">Topdraw Utility</a> for drawing
protein topology cartoons. It should be set to <strong>topdraw</strong>.</p>

<h3><a name="ccp4mg"></a>CCP4mg</h3>

<p>This is the command used to run the CCP4mg (CCP4 molecular graphics) program.
It should be set to the full path of the <strong>ccp4mg</strong> executable on
your system.</p>

<p>See the <a href="http://www.ysbl.york.ac.uk/~ccp4mg/ccp4mg_help">CCP4mg on-line
documentation</a></p>

<h2><a name="external_programs"></a>External Programs</h2>

<h3><a name="hypertext_viewer"></a>Viewing HTML Help Text</h3>

<p>This currently assumes the use of Netscape but can use alternative hypertext
viewers. The exact usage depends on the version of Netscape. The distributed
version is for Netscape30. When
<a href="../index.html" target="_top">started up outside the Interface</a>
it works well in InternetExplorer, and older and newer versions of Netscape.</p>

<p>If there are problems this brief explanation may help
in troubleshooting. The script <strong>$CCP4I_top/src/local.tcl</strong> contains
the procedure <strong>open_url</strong>. For Netscape it checks to see whether
there is a locally running version of the browser, and starts one (using the
command given in this option) if not. After a delay, or if there is already a
version running, then it tries to display the HTML file  using the
'<strong><tt>netscape -remote</tt></strong>' option
(you can read about this by entering '<strong><tt>netscape -help</tt></strong>' on
the command line or look at the
<a href="http://www.netscape.com/newsref/std/x-remote.html">Netscape help</a> on
this topic).</p>

<p>The procedure <strong>poll_netscape</strong> invoked from <i>open_url</i> is
will make multiple attempts to open the page, in case there is a delay in Netscape
responding to these requests when it is first launched.</p>

<p>Note that if you are running CCP4i on a remote machine over an X connection, but
have Netscape running on the local machine, then CCP4i may start Netscape on the
remote machine but then try to open the page via the local Netscape. This can be
irritating but should be solved by opening the page a second time.</p>

<h3><a name="map_format_conversion"></a>Map File Format Conversion Options</h3>

<p>Converting maps to non-CCP4 formats requires running
non-CCP4 programs. Currently O and Quanta formats are handled. The default
conversion programs are:
<em>/o/rave_irix6/6d_mapman</em> and <em>/quanta97/maps/mbkall</em>.
You should change the program path names appropriately for your system.</p>

<p>Very large maps may exceed the default maximum size for the Mapman program and
require an extra command MAPSIZE. CCP4i scripts will include an appropriate command
if a map exceeds the value given here. This value can be found for your version of
Mapman by running the program and noting the value for 'Max nr of points in map'.
Individual users can choose the preferred output map format in the
<a href="preferences.html" target="_MAIN">Preferences</a> window
- if most users on your site are liable to have the same preference then the system
manager could set the installation default in the Preferences window (accessed from
menu on the right-hand side of the main CCP4i window). By default CCP4i scripts will
use the NORMALISE command in Mapman and produce normalised maps - this can also be
changed in the Preferences window.</p>

<p>I am happy to add conversions for other graphics
programs but will need information from you on the command string required
to run the conversion program.</p>

<h3><a name="modeller"></a>Options for running MODELLER</h3>

<p>MODELLER is an homology modelling program which can be used to reduce manual editing
of structures particularly in molecular replacement. CCP4i has a task interface to some
limited functionality of MODELLER, called Edit Protein Structure, in the
<a href="../modules/molrepl.html" target="_MAIN">Molecular Replacement module</a>. This
program is not distributed by CCP4 but can be obtained from:
<a href="http://guitar.rockefeller.edu/" target="_EXTERNAL">Sali Lab at The Rockefeller
University</a>.</p>

<p>In the configure window you should enter the MODELLER install directory (called
MODINSTALL in MODELLER documentation) and the install keyword which you must obtain
following the instructions on the above web pages. Since alternative versions of the
MODELLER program may be installed you must give the name of the one you want to use.</p>

<h3><a name="shelxs"></a>Running SHELXS</h3>

<p>CCP4i has a task interface to the direct methods functionality of SHELX-90 in
the <a href="../modules/exptphase.html" target="_MAIN">Experimental Phasing module</a>
(the SHELXS program). This program is not distributed by CCP4 but can be obtained from:
<a href="http://shelx.uni-ac.gwdg.de/SHELX/" target="_EXTERNAL">THE SHELX HOMEPAGE</a>.</p>

<p>You should enter the full path name of the ShelxS program in the configure window.
Note that similar configuration is not required for the newer ShelxC, D and E programs
- as long as the programs appear in your PATH the interface should find them
automatically.</p>

<h3><a name="disable_tasks"></a>Disable tasks with missing programs</h3>

<p>Some tasks specify "prerequisites", which are programs that the task cannot be
run without. If these prerequisites are missing from the path then the task button
will be displayed in a disabled form, and will not be able to launch the task.</p>

<p>In some cases, for example when running on a remote machine which has programs
that are missing from the local system, it is necessary to allow CCP4i to ignore
missing prerequisites.</p>

<p>Note that not all tasks have prerequisities defined, and for these tasks the
user may still launch them even though programs required may be missing.</p>

<h3><a name="program_full_paths"></a>Full paths of programs</h3>

<p>This allows the specification of a full path (i.e. including the leading directory
name) in order to overcome name conflicts (for example, where a system utility
shares the name of a crystallographic program). Be aware that this may need to be
updated whenever a new version of CCP4 is installed.</p>

<h2><a name="customize_colours"></a>Customize Joblist Colours</h2>

<p>This folder contains options to allow the user to select a colour scheme for the
display of jobs in the main CCP4i window. The option to use the custom colours must
first be turned on. The user can then choose default text and background colours to
use, as well as selecting specific colours for each job based on job status, title,
taskname and so on.</p>

<h2><a name="help"></a>Help</h2>

<h3><a name="bubble_help"></a>Enabling Bubble Help</h3>

<p>When the mouse moves over a widget in a CCP4i window, any associated help
text will be displayed in the "message line" at the top of that window. If
bubble help is enabled then, after a short time-delay, this text will also
be displayed in a "bubble" or "balloon" next to the widget in question.
If bubble help is not enabled then only the message line help will be visible.</p>

<h2><a name="hardware_resources"></a>Hardware Resources</h2>

<h3><a name="remote_machine"></a>Running Jobs Remotely</h3>

<p>The Interface will run jobs on other machines on the same network which
can see the same filesystem, using either the <strong>rsh</strong> or the 
<strong>ssh</strong> command. The Interface <strong>Run Remote</strong> command
definitely will not work across any connection that either of these commands
are unable to work across.</p>

<p>You should enter a list of the machines which users are encouraged to
run large jobs on. The default choice of protocol is also specified here
(either <strong>rsh</strong> or <strong>ssh</strong>, as noted above).</p>

<p>The procedure to run remote jobs is in <strong>$CCP4_top/src/local.tcl</strong>
- you probably do NOT want to look at it!</p>

<h3><a name="batch_queues"></a>Batch Queues</h3>

<p>If you run a batch queue system, you will need to enter a name for the queue and then
the command which will be used by the script to submit a job to that queue. The user is
given the option to enter options at the time that they submit the job so the command takes
the form:
<pRE>
 batch_queue_command  options csh_command_script
</pre>
where csh_command_script is the name of a command script created automatically by CCP4i.</p>

<p>More information on batch queues can be found on a
<a href="batch_queues.html">separate page</a>.</p>

<h3><a name="postscript_files"></a>Postscript Files</h3>

<h4><a name="postscript_viewers"></a>Postscript Viewers</h4>

<p>Various programs can be used to display postscript files on screen. Set any local preferences
here. The first option will be used by default.</p>

<h4><a name="printers"></a>Printing Postscript Files</h4>

<p>The loggraph program has options to print postscript files in colour
or monochrome and several places in the interface could potentially print
out text files. You need to enter two separate lists for
black&amp;white printers and colour printers available at your site.</p>

<p>For each printer you should enter a single word name for the printer
which will appear on the menu for the user to choose a printer and the
command string required to send a job to that printer. The
command string would usually be of the form:
<strong>lp -c -Dprinter_name</strong>.
The -c option is advisable as the interface may otherwise delete a
temporary file before the printer has a chance to print it. The
name of the file to be printed will be appended to the command string.</p>

<h2><a name="network_resources"></a>Networked Resources</h2>

<h3><a name="proxy"></a>Declare Proxy Server</h3>

Some CCP4 programs connect to external databases over the internet in order
to download a requested file. If your site uses a proxy server for http requests, 
this should be declared here, otherwise the download will fail.

<h3><a name="sequence_database"></a>Sequence Database Retrieval Command</h3>

<p>This option is explained in detail in the documentation for the
<a href="../../../../html/get_prot.html" target="_EXTERNAL">Get Protein Sequence</a> task;
see the section on
<a href="../../../../html/get_prot.html#Changing the external database" target="_EXTERNAL">Changing the External Database</a>.</p>

<h2><a name="fonts"></a>Fonts</h2>

<p>The fonts used by the Interface are defined in
the file <strong>$CCP4I_top/etc/configure.def</strong>. If the default fonts are
not available on your machine, you will not be able to run the Interface
configure utility but will have to edit the <strong>configure.def</strong> file
manually. The format of this file is: one parameter per line with three
items on the line (the parameter name, a data type for the parameter and
the default value for the parameter). If your machine does not support the
fonts specified in the file, you will need to edit the file to change
the default values of the following parameters: <tt>font_FIXED</tt>,
<tt>font_REGULAR</tt>, <tt>font_ITALIC</tt>, <tt>font_BIG</tt> or
<tt>font_SMALL</tt>.</p>

<p>The font which will probably cause problems, is
the fixed width font. If attempts to run the Interface causes crashes with
warning messages about <tt>font_FIXED</tt>, try the most generic form for
this font, which is:</p>

<pRE>
-*-Fixed-*-*-*-*-*-*-*-*-*-*-*-*
</pre>

<p>(that's a total of 14 fields separated by dashes!).</p>

<p>On SGIs and possibly other Unix/Linux systems the system utility
<strong>xfontsel</strong> can be used to find a font.</p>

<p>The <strong>configure.def</strong> file contains the definition of two font
sets - large and small. The value of the parameter <tt>font_SET</tt> should
be 'large' or 'small'. The fonts in the large font set are <tt>L_font_REGULAR</tt>,
<tt>L_font_ITALIC</tt>, <tt>L_font_BIG</tt> and <tt>L_font_SMALL</tt>. Similarly,
the fonts in the small font set are <tt>S_font_REGULAR</tt>, <tt>S_font_ITALIC</tt>,
<tt>S_font_BIG</tt> and <tt>S_font_SMALL</tt>. When the user selects to run either
the large or small font set, the appropriate set of parameters are copied into the
'current' font set. If you want to support the large/small font option on your system,
you will need to find appropriate values for both the large and small
font set.</p>

<p>I would appreciate hearing from anyone who has
problems with fonts on different machine types so we can try to avoid them
in future.</p>

<h2><a name="testing"></a>Testing the Local Resources</h2>

<p>The file <strong>$CCP4I_top/etc/configure.def</strong> contains
the definition of local resources which can be viewed and edited in a
graphical interface by entering the command:</p>

<pRE>
<strong>&gt; ccp4i -c[onfigure]</strong>
</pre>

<p>The <strong><tt>Test</tt></strong> button at the bottom
of this window has options to test how well the Interface interacts with
the various resources. These are described individually below.</p>

<p>NOTE: If you change any of the parameters
in the window, you should save them to file using the <strong><tt>Save</tt></strong>
button before trying any of the <strong><tt>Test</tt></strong> options.</p>

<h3><a name="test_hypertext"></a>Hypertext Viewer</h3>

<p>As a test, this attempts to open this page using the hypertext viewer
specified in the configuration settings. If successful the viewer should
start, otherwise there will an warning displaying the last system error
message.</p>

<h3><a name="test_loggraph"></a>BLT &amp; Printing</h3>

<p>This test option automatically runs the loggraph
program to display the graphs defined in the file $CCP4I_top/test_data/scaleit.log.
Once the loggraph window in displayed you should do the following:</p>

<ul>
<li>Select a table from the list in the middle of the window</li>
<li>Select a graph from the list at the bottom of the window</li>
<li>You should now see a graph displayed in the top of the window</li>
<li>From the File pull-down menu select Print Graph</li>
</ul>

<p>You now have a window containing several print
options - you can test the printers you have specified for monochrome and
colour plots and the programs used for previewing the print.</p>

<p>There are several possible problems which could
cause this test to fail - the symptoms and diagnoses are:</p>

<h5>Warning message 'Failed to start loggraph program'</h5>

<p>Check that the loggraph program $CCP4I_top/bin/loggraph
will start up stand-alone. Failure is probably because it can not find
the <strong>bltwish</strong> executable invoked at the top of the script.</p>

<h5>When attempting to print or preview print warning
message 'Error could not open prologue file'</h5>

<p>This suggests that the BLT library directory
set in the configure interface is wrong.</p>

<!--<h4><a name="test_print"></a>Text Printing</h4>-->

<h4><a name="test_running_jobs"></a>Testing Running Jobs</h4>

<p>It is worthwhile testing the running of both local and remote jobs at installation time
by following this simple example.</p>

<p>If you are running ccp4i with the configure option (<em>i.e.</em> <strong>ccp4i -c</strong>)
then close this window and start the main interface with the command <pRE>&gt; ccp4i</pre>
Select <tt>Configure Interface</tt> from near the bottom of the menu on the right-hand side of
the Main Window. Select <tt>Running Task</tt> from the 'Test' menu at the bottom of the
Configure window.</p>

<p>To test running a job, you will be given the interface to the <tt>Convert to MTZ &amp;
Standardise</tt> task with suitable parameters already set.</p>

<p><strong>To test running on your local machine</strong>:
<ol>
<li>From the <tt>Run</tt> menu on the bottom left of the window select <tt>Run Now</tt>.</li>
<li>Watch in the centre of the Main Window where an '<tt>import</tt>' job should be listed with
status STARTING which changes to RUNNING and then to FINISHED.</li>
<li>You can check the log file and command script through the <tt>View Files from Job</tt> menu
on the right-hand side of the Main Window.</li>
</ol>

<p><strong>To test running on a remote machine</strong>:
<ol>
<li>From the <tt>Run</tt> menu on the bottom left of the window select <tt>Run Remote/Batch/Later</tt>.</li>
<li>In the <tt>Run Remote</tt> window select a machine and click the <tt>Run</tt> button.</li>
<li>Watch in the centre of the Main Window where an '<tt>import</tt>' job should be listed with
status REMOTE which should change to FINISHED when the job completes.</li>
<li>You can check the log file and command script through the <tt>View Files from Job</tt> menu on the
right-hand side of the Main Window.</li>
</ol>

<p>Possible problems:
<table border>
<tr><th>symptom</th><th>cause</th></tr>
<td>When running remotely the job does not start (produces no log file)</td>
<td>The command to set up CCP4 has not been set in the Configure interface</td>
</tr>
</table>

<h3><a name="saving_configuration"></a>Saving the Configuration Setup</h3>

<p>The configuration setup window has two options for saving the setup: either to
<strong><tt>Save to Installation File</tt></strong> or to
<strong><tt>Save to User's Home Directory</tt></strong>. You should only save to
the installation file (<strong>$CCP4I_top/etc/configure.def</strong>)
if you are the system manager responsible for installing CCP4i. If you
are not the system manager, you should not have write permission to this
file if your system manager has set things up wisely. The alternative is
to save a personal configuration preference to your
<strong>$HOME/.CCP4/unix/configure.def</strong> file.</p>

<h3><a name="sending_mail"></a>Sending Mail</h3>

<p>This is used by the <strong><tt>Mail CCP4</tt></strong> button on the main
interface to send mail to the Interface developer.</p>

<p>For Unix-type systems, the procedure <tt>SendMail</tt> in
<em>$CCP4I_top/src/local.tcl</em> uses the system command <tt>mail</tt> to send mail.
If this is inappropriate for your system, you will need to edit the local.tcl file.
On Windows systems the URL <a href="http://www.ccp4.ac.uk/reportaprob.html" target="_EXTERNAL">http://www.ccp4.ac.uk/reportaprob.html</a> is opened, which allows on-line
reporting of bugs to the CCP4 staff.</p>

<table border="0">
<tr><td>
<a href="install.html" target="_PROGRAMMERSDOCS">
<img border="0" class="navbutton" src="../images/3Dnexttr.gif" alt="next button" /></a>
</td></tr>
</table>

</body>
</html>

