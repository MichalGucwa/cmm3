<!doctype html public "-//w3c//dtd html 3.2//en">
<html>
<head>
<title>CCP4 Interface: The Database Utility</title>
<link rel="stylesheet" type="text/css" href="../ccp4idocs.css" title="CCP4i" />
<link rev="made" href="mailto:mgwt@ysbl.york.ac.uk" />
<meta name="GENERATOR" content="Mozilla/3.0Gold (X11; I; IRIX 6.2 IP22) [Netscape]" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="AUTHOR" content="Maria and Liz" />
</head>
<body>

<table border="0">
<tr><td rowspan="2"><img src="../images/weblogo175.gif" alt="CCP4 web logo" /></td>
<td class="logohead">CCP4i: Graphical User Interface</td></tr>
<tr><td class="logotitle">The Database Utility</td></tr>
</table>
<br />
<table border="0">
<tr><td>
<a href="fileviewer.html" target="_self">
<img border="0" class="navbutton" src="../images/3Dnexttr.gif" alt="next button" /></a>
<a href="fileselect.html" target="_self">
<img border="0" class="navbutton" src="../images/3Dprevtr.gif" alt="previous button" /></a>
<a href="../index.html" target="_top">
<img border="0" class="navbutton" src="../images/3Dtoptr.gif" alt="top button" /></a>
</td></tr>
</table>

<p><a href="#setting_up" target="_self">Setting up</a></p>

<p><a href="#job_list" target="_self">The Job List</a></p>

<dl>
<dt><a href="#database_menu" target="_self">The Database Menu</a></dt>
<!--<dd><a href="#manage_chain" target="_self">Manage Chain</a></dd>-->
<dd><a href="#view_files_from_job" target="_self">View Files from Job</a></dd>
<dd><a href="#search_sort_db" target="_self">Search/Sort Database</a></dd>
<dd><a href="#delete/archive_files" target="_self">Delete/Archive Files</a></dd>
<dd><a href="#kill_job" target="_self">Kill Job</a></dd>
<dd><a href="#rerun_job" target="_self">ReRun Job</a></dd>
<dd><a href="#edit" target="_self">Edit Job Data</a></dd>
<dd><a href="#preferences" target="_self">Preferences</a></dd>
<dd><a href="#system_administration" target="_self">System Administration</a></dd>
</dl>

<p><a href="#CCP4_DATABASE" target="_self">The CCP4_DATABASE</a></p>

<p>The Database Utility maintains a record of all tasks performed in
a project. The Interface provides simple tools to archive and restore data
files, which can function as a notebook or logbook. The user can add any other
information. Thus, it is possible to keep track of a structure
determination and refinement process without using a pen and paper.</p>

<h3><a name="setting_up"></a>Setting up</h3>

<p>Setting up a Database for a project starts with choosing a Project directory
using the <strong>Directories&amp;ProjectDir</strong> interface. A database directory
called <a href="#CCP4_DATABASE" target="_self">
<strong>CCP4_DATABASE</strong></a> is usually set up
as a subdirectory of the Project directory.</p>

<h3><a name="job_list"></a>The Job List</h3>

<img align="center" src="../images/mainwindow-10may05-joblist.png" alt="Job List in Main Window"
border="0" />

<p>The <strong>Job List</strong> window (in the centre of the Main Window of the Interface,
coloured salmon pink in the picture) is a reverse order list of all the jobs. The format of each line
in the List is:</p>

<dl>
<dt><strong>Job number</strong></dt><dd>Each job is assigned a number at run time</dd>
<dt><strong>Date or time</strong></dt><dd>Lists the start time of a running job or
the finish time. For jobs not run today the date of run is listed</dd>
<dt><strong>Status</strong></dt><dd>See <a href="intro.html#progress"
target="_self">Introduction</a></dd>
<dt><strong>Task<!--s list--></strong></dt><dd><!--For a chained job all the tasks are
listed-->Task name</dd>
<dt><strong>Title</strong></dt><dd>The title entered by the user in the task window</dd>
</dl>

<h3><a name="database_menu"></a>The Database Menu</h3>

<img align="center" src="../images/mainwindow-10may05-databasemenu.png" alt="Database Menu in Main Window"
border="0" />

<p>The Database menu is the scrollable menu on the right-hand-side of the Main
Window, below <strong><tt>View Any File</tt></strong> (coloured salmon pink in the picture).
Most of the options in the menu require that <em>one</em> job is selected from the Job List by
clicking the left mouse button on the desired line. If <em>more than one</em> job is currently
selected, the action will be applied to the last selected. If <em>no</em> jobs are selected,
the action will be applied to the job at the top of the list. More than one job may be
selected for the option <strong><tt>Delete/Archive Files</tt></strong>.<br />
<em>All job selections can be cleared using the <strong>F2</strong> function key on your
keyboard.</em></p>

<p>The Database menu contains the following options:

<dl>
<!--<dt><strong><tt><a href="#manage_chain" target="_self">Manage Chain</a></tt></strong></dt>
<dd>only present when chaining tasks
(see <a href="runjob.html#chaining" target="_self">Chaining tasks</a>)</dd>-->

<dt><a href="#view_files_from_job" target="_self"><strong><tt>View Files from Job</tt></strong></a></dt>
<dd><a href="#view_logfile_in_web_browser" target="_self"><strong><tt>View LogFile in Web Browser</tt></strong></a></dd>
<dd><a href="#view_logsummary_in_web_browser" target="_self"><strong><tt>View LogSummary in Web Browser</tt></strong></a></dd>
<dd><a href="#view_log_file" target="_self"><strong><tt>View Log File</tt></strong></a></dd>
<dd><a href="#view_log_graphs" target="_self"><strong><tt>View Log Graphs</tt></strong></a></dd>
<dd><a href="#view_command_scripts" target="_self"><strong><tt>View Command Scripts</tt></strong></a></dd>
<dd><tt>List of Input/Output Files</tt></dd>

<dt><a href="#search_sort_db" target="_self"><strong><tt>Search/Sort Database</tt></strong></a></dt>

<dt><a href="#delete/archive_files" target="_self"><strong><tt>Delete/Archive Files</tt></strong></a></dt>

<dt><a href="#kill_job" target="_self"><strong><tt>Kill Job</tt></strong></a></dt>

<dt><a href="#rerun_job" target="_self"><strong><tt>ReRun Job</tt></strong></a></dt>

<dt><a href="#edit" target="_self"><strong><tt>Edit Job Data</tt></strong></a></dt>
<dd><a href="#edit_notebook_read_edit" target="_self"><strong><tt>Read/Edit Notebook</tt></strong></a></dd>
<dd><a href="#edit_edit_job_data" target="_self"><strong><tt>Edit Job Data</tt></strong></a></dd>
<dd><a href="#edit_enter_external_data" target="_self"><strong><tt>Enter Data for External Job</tt></strong></a></dd>

<dt><a href="#preferences" target="_self"><strong><tt>Preferences</tt></strong></a></dt>

<dt><a href="#system_administration" target="_self"><strong><tt>System Administration</tt></strong></a></dt>
<dd><a href="#view_session_log" target="_self"><strong><tt>View Session Log</tt></strong></a></dd>
<dd><a href="#configure_interface" target="_self"><strong><tt>Configure Interface</tt></strong></a></dd>
<dd><a href="#edit_modules_file" target="_self"><strong><tt>Edit Modules File</tt></strong></a></dd>
<dd><a href="#install_new_task" target="_self"><strong><tt>Install New Task</tt></strong></a></dd>
<dd><a href="#run_tests" target="_self"><strong><tt>Run Tests</tt></strong></a></dd>
</dl>
</p>

<!--<h4><a name="manage_chain"></a>Manage Chain</h4>

<p>The <strong>Manage Chain</strong> button is only present when you are
actually chaining tasks. It carries a pop-up menu with the following options:

<dl>
<dt><strong>Close Chain</strong></dt>
<dd>In case the chain is not run immediately, <em>e.g.</em> because an input
file is not in place, it can be closed and put on hold. It can then be
run by using the
<a href="#rerun_job" target="_self">Rerun Job</a>
option, where the input may be adapted.</dd>

<dt><strong>Close &amp; Run Chain</strong></dt>
<dd>Cut short a chain that could have grown longer, but can run fruitfully
as a shorter version.</dd>

<dt><strong>Close &amp; Delete Chain</strong></dt>
<dd>Stop the chain and delete the script file created so far.</dd>
</dl>
</p>-->

<h4><a name="view_files_from_job"></a>View Files From Job</h4>

<p>All of the files associated with the selected job (log file and all
extant input and output files) are listed in a pop-up menu. The selected file
is displayed with
<a href="fileviewer.html" target="_self">The FileViewer Utility</a> (unless
otherwise stated).</p>

<p>The pop-up menu contains the following:

<dl>
<dt><a name="view_logfile_in_web_browser"></a><strong>View LogFile in Web Browser</strong></dt>
<dd>If the log file is in HTML format, there is the option for them to be displayed in
a web browser, including links to documentation and in-line graphs. Note that there may
be some delay as Netscape first loads the Java applet to display graphs.</dd>

<dt><a name="view_logsummary_in_web_browser"></a><strong>View LogSummary in Web Browser</strong></dt>
<dd>If the log file is in HTML format, the sections tagged as SUMMARY are displayed in a web
browser.</dd>

<dt><a name="view_log_file"></a><strong>View Log File</strong></dt>
<dd>Display log file with the FileViewer utility, regardless of the file format.</dd>

<dt><a name="view_log_graphs"></a><strong>View Log Graphs</strong></dt>
<dd>Display the graphs from a log file with
<a href="loggraph.html" target="_self">The Loggraph Utility</a>.</dd>

<dt><a name="view_command_scripts"></a><strong>View Command Scripts</strong></dt>
<dd>Display the command scripts for the CCP4 programs which were run for the selected job
<em>Beware: since these are temporary files written to the scratch area ($CCP4_SCR, which
may or may not be the same as your TEMPORARY directory), they will probably not be kept
indefinitely on your computer. Also, if you run a job on a remote machine with a
different definition of $CCP4_SCR, these files may not be visible even if they do
exist.</em></dd>
</dl>

<p>The remainder of the pop-up menu is filled with all other input and output files
associated with the selected job.</p>

<h4><a name="search_sort_db"></a>Search/sort Database</h4>

<p>This tool is there to help you find your way around the database as the number
of tasks increases. On the one hand it enables you to search on both general and
specific criteria, on the other it offers the possibility of having a simple
re-ordered view of the database which can be customised to be sorted on
more complex criteria.</p>

<p>The defaults setting of the tool is a simple search. The first step is to
specify whether you want to search or sort, and then to select whether it will
be "simple" or "advanced":</p>

<dl>
<dt><b>Simple Search:</b></dt>
<dd>This means you can specify up to three criteria among <i>Status, Title</i>
and <i>Taskname</i>. Select the appropriate criteria by enabling the button in
front of it and giving it the value you want.</dd>

<dt><b>Advanced Search:</b></dt>
<dd>In addition to the previous 3 criteria you now have the opportunity of
specifying <i>Date, Input file</i> and <i>Output file</i>. Concerning
the date be aware that the year is 4 digits! For choosing the input file,
as in any other task you do this by selecting the file in the filebrowser (or
giving its name if your already know).</dd>

<dt><b>Simple Sort:</b></dt>
<dd>The default setting is the <i>job number</i> but you can sort on
3 other criteria, <i>Status, Job Title</i> and <i>Taskname</i> respectively. In
this case the database is sorted by ascending or descending alphabetical order 
depending on what you select on the right.</dd>

<dt><b>Advanced Sort:</b></dt>
<dd>When you select this mode you will see an additional line for another
sorting criterion. It means that among the items whose values match the first
sorting criterion, they will be subsorted against the second. You can enable
this second criterion by selecting the button at start of the line. The advanced
sort allows up to 3 additional criteria.</dd>
</dl>

<p>Once you have results displayed you can interact with them using the buttons on
top of the frame displaying them. The interaction with the list of jobs in the results
is exactly the same as in the main window. If there is no job selected among the list
than the interaction will be with the last job you ran.</p>

<p>After performing a search request, you can refine your search by
adding more criteria or by sorting the results as you like, using the
<i>Apply to Result</i> button.</p>

<p>The <I>Reset</i> button allows you to reset the window to start a new
search.</p>

<h4><a name="delete/archive_files"></a>Delete/Archive Files</h4>

<p>This is a means to explicitly delete temporary files or output which
you no longer wish to keep. It is also a means to 'archive' files which
means saving a compressed version of the file to the database directory.
Note that temporary files are usually written to the TEMPORARY directory
and, depending on the setup in your lab, these may be deleted automatically
after a period.</p>

<p>The default cleanup level can be set in the
<a href="preferences.html" target="_self">Preferences</a> window. The program default
is the 'safe' option to 'Delete temporary file' but most users will probably prefer the
'Delete output files and remove from database'. If you have selected more than one job,
there is an option at the top of the window to reset the cleanup mode for all
selected jobs.</p>

<p>For each of one or more jobs selected from the job list you have the
option of several levels of cleanup:</p>

<dl>
<dt><strong>Do nothing</strong></dt>
<dd>Self-explanatory.</dd>

<dt><strong>Delete temporary files</strong></dt>
<dd>Delete the files with extension <strong>.tmp</strong>
created by the run script on the TEMPORARY area. These will be mostly input
command scripts for CCP4 programs but there may be other intermediate files.
This is the default option. This default can be changed through the
<a href="preferences.html#delete/archive_files" target="_self"><tt>Preferences</tt></a>
button.</dd>

<dt><strong>Delete all output files</strong></dt>
<dd>As above and delete the log file and all output files.</dd>

<dt><strong>Delete output files &amp; remove from database</strong></dt>
<dd>As above and remove all record of the job from the database.</dd>
</dl>

<p>The log file and any other extant output files are listed with options
to:<br />
<strong>Delete</strong>, <strong>Keep</strong>, <strong>Archive</strong>,
<strong>Archive&amp;delete</strong>,
<strong>Retain archive</strong>, <strong>Restore archive etc.</strong><br />
The default option is set to either <strong>Delete</strong> or <strong>Keep</strong>,
dependent on the cleanup level chosen. This default will be overridden if you change
the option for the individual file.</p>

<p>Archiving a file involves saving a compressed version of the file (by
default it is compressed with the <em>gzip</em> utility) to the
$Project/CCP4_DATABASE&nbsp;directory. The archived file has the original
file name, with the extension <strong>.gz</strong> added.</p>

<p>If there is already an archived version of the file, options to
<strong>Retain archive</strong> (<em>i.e.</em> keep it, no change) or
<strong>Restore archive</strong> (uncompress and copy back to the original file
name) are present.</p>

<p>The <strong>Restore</strong> options in the archive include
either deleting the original file or, if not explicitly stated, the original is
undeleted. </p>

<!--mgwt 12jan99:
testing archive on job 10 (import rnase18 uniqueify)
* delete temporary files does NOT delete SCRATCH/scripts_10.tmp
* two 'archive hilights' options are not available on log files; will not be
  implemented. Reference removed from docs, now need to be removed from Interface
* 'archive' log file and press 'apply&exit'
>>>>>>> creates ccp4itut/CCP4_DATABASE/10_ccp4itut_10_import.log.gz
   (so that's an extra '10' to start with), and
   archiving options do not change for the log file
* 'archive' output file and press 'apply&exit'
>>>>>>> creates ccp4itut/CCP4_DATABASE/10_rnase18_unique1.mtz.gz
   (that extra '10' again), and
   archiving default changes to 'keep&retain archive'
* 'archive' log file again, and press 'apply&exit'
>>>>>>> creates ccp4itut/CCP4_DATABASE/10_ccp4itut_10_import.log and
   leaves the gz version alone,
   archiving option still 'keep' default, no way of restoring or retaining
    (log on scratch and database are exactly the same)
* 'archive&delete' log file, and press 'apply&exit'
>>>>>>> no change on ccp4itut/CCP4_DATABASE (so log and log.gz present from
   earlier attempts), and
   log file deleted from SCRATCH, and
!!!!!!!!!!!!! archiving options now changed. 'retain archive' is default,
   other options: 'restore archive', 'delete archive' and 'restore&delete archive'.
* 'restore archive' log file, and press 'apply&exit'
>>>>>>> no change on ccp4itut/CCP4_DATABASE; SCRATCH/ccp4itut_10_import.log
   present again, with today as date, and
   archiving options back to first menu (default 'keep')
* 'delete' log file, and press 'apply&exit'
>>>>>>> no change on DATABASE, but deleted from SCRATCH, and
   archiving options back to 'retain', 'restore' etc.
* 'restore&delete archive' log file, and press 'apply&exit'
>>>>>>> 10_ccp4itut_10_import.log.gz gone from DATABASE (10_ccp4itut_10_import.log still there),
   ccp4itut_10_import.log present on SCRATCH, and
   archiving options back to original
* 'archive&delete' log file, and press 'apply&exit'
>>>>>>> creates DATABASE/10_ccp4itut_10_import.log.gz and
   deletes from SCRATCH, but DATABASE/10_ccp4itut_10_import.log also gone!!!!!!!!!!!!!!!

-->

<h4><a name="kill_job"></a>Kill Job</h4>

<p>The Interface will terminate the currently selected job, or the last one if
no job is explicitly selected. It will ask you to confirm that you want to kill
the job. Any running job will have one process which is running a script and probably
a child process which is the running program. The Interface will attempt to kill the
child program process but if it can not find a program process after three retries,
it will kill the script process. The Job List will show the job status as KILLED.
The Interface will kill both local and remote jobs. Whilst killing local jobs usually
takes immediate effect, you should expect some delay in killing a remote job.</p>

<p>This operation is very dependent on the operating system; if you have problems,
the following information may help. To kill a job, the Interface reads the header of
the log file which has the script process ID on the line commencing "#CCP4I PID".
It uses the Unix commands 'ps -l' to find the currently running processes and the
'kill -9' command to kill a process. If the attempt to kill a process fails, the
Interface should report where it has failed. If you have problems, please report
them to CCP4 or look in the script $CCP4I_top/src/local.tcl at the procedures
KillScript and KillRemoteScript.</p>

<h4><a name="rerun_job"></a>ReRun Job</h4>

<p>This provides for speedy rerunning of jobs that FAILED or ones you wish
to repeat with minor changes of parameters.<!-- This is also the way to run
chained jobs that are on hold.--></p>

<p>Select a job from the Job List before clicking <strong><tt>ReRun Job.</tt></strong></p>

<p>A Rerun Job window comes up. The task window(s) for the job may be reviewed
and edited before rerunning the task. <!--If the job was composed of multiple
tasks in a chain and has failed half way through then the early successful
tasks can be prevented from running by clicking the green button to the
left of the task name to &quot;off&quot;.--></p>

<h4><a name="edit"></a>Edit Job Data</h4>

<p>The <tt><strong>Edit Job Data</strong></tt> menu contains the following:</p>

<dl>
<dt><a name="edit_notebook_read_edit"></a><strong>Read/Edit Notebook</strong></dt>
<dd>
<p>This is a means to save any comments about a job. Select a job from the Job List first.</p>

<p>Each job has its own notebook file in the database directory which is created when you select
<strong><tt>Read/Edit Notebook</tt></strong>. The file is
created with header information indicating to which job it belongs. You
should edit in your comments after the header information.</p>
</dd>

<dt><a name="edit_edit_job_data"></a><strong>Edit Job Data</strong></dt>
<dd><p>There is an option to edit the data stored
in the database. This might be useful if you rename a file and want to update the
information in the database or if you want to change (or add) a title for a job.</p></dd>

<dt><a name="edit_enter_external_data"></a><strong>Enter Data for External Job</strong></dt>
<dd><p>There is also an option to <tt><strong>Enter Data for External Job</strong></tt>
which will allow you to input information on jobs run outside the database.
For example this might be useful for recording what you did using molecular graphics.
You can record the names of input and output files and also then use the Edit Notebook
facility to write up what you did in more detail.</p></dd>
</dl>

<h4><a name="preferences"></a>Preferences</h4>

<p>In order to change Interface defaults, <em>e.g.</em> where output files go, use
the <a href="preferences.html" target="_self"><tt>Preferences</tt></a> button.</p>

<h4><a name="system_administration"></a>System Administration</h4>


<dl>
<dt><a name="view_session_log"></a><strong>View Session Log</strong></dt>
<dd>
<p>Each CCP4i run keeps a session log file recording only significant actions such as
jobs run and files deleted. It may also contain error diagnostics which might be useful to
the developer but probably not to the user. The log file is saved as $HOME/.CCP4/CCP4_session.log.
Each time CCP4i starts up, any existing file of that name is overwritten. The session log
file can be viewed from the Interface using the 'View Session Log File' option on the right
hand side of the Main Window.</p>
</dd>

<dt><a name="configure_interface"></a><strong>Configure Interface</strong></dt>
<dd>
<p>The Interface can be configured to use different system resources such as web
browsers, printers and remote machines. Most users should not need to change
these as they should have been set up when CCP4i was installed. The one option
they may like to change is size of fonts.</p>

<p>A <a href="configure.html" target="_PROGRAMMERSDOCS">detailed description</a> of how the Interface
can be configured to the user's preferences, can be found elsewhere.</p>

<p>The user can save the setup with the <strong><tt>Save</tt></strong> button and should
usually choose the <strong><tt>Save to user's home directory</tt></strong> option.
The Interface will be updated to reflect the new configuration
but it may be necessary to close and reopen a window to see the new configuration.</p>
</dd>

<dt><a name="edit_modules_file"></a><strong>Edit Modules File</strong></dt>
<dd>
<p>The <tt>Edit Modules File</tt> button gives a window to edit the modules and
task references which appear in the menus on the left-hand side of the main CCP4i
window, and which are stored in the <a href="../programmers/modules.html"
target="_PROGRAMMERSDOCS">modules.def</a> file.</p>
</dd>

<dt><a name="install_new_task"></a><strong>Install New Task</strong></dt>
<dd>
<p>The <a href="install.html" target="_PROGRAMMERSDOCS"><tt>Install New Task</tt></a>
button gives a window to copy new task definitions (from a <tt>Task source</tt>) into
the current installation. There are also options to uninstall tasks which have
previously been installed using this function.</p>
</dd>

<dt><a name="run_tests"></a><strong>Run Tests</strong></dt>
<dd><p>See separate document on <a href="runtests.html">how to run test jobs</a>.</dd>
</dl>

<h3><a name="CCP4_DATABASE"></a>The CCP4_DATABASE</h3>

<p>All the database information is saved in the CCP4_DATABASE sub-directory
of the Project directory. It is kept here so that if the Project directory
is moved (between computers/labs etc.), the database is less likely
to be left behind. In this directory are:

<dl>
<dt><a name="save_database_to_file"></a><strong>database.def</strong></dt>
<dd>The information in the Job List and additional information is
saved in this file when the <strong><tt>Save Database to File</tt></strong>
option is used. The file has the standard <strong>.def</strong> file format.</dd>

<dt><strong>Parameter def files</strong></dt>
<dd>For each task run the parameters are saved in a <strong>.def</strong> file.
<!--For chained files there is a <strong>.def</strong> file for each task.-->The file name
is constructed from the job number (<em>jobid</em>)<!--, the position of the task in the
chain (<em>chainid</em>; for simple, unchained jobs this is 1)--> and the name of the
<!--first--> task <!--in the chain-->(<em>task</em>), as follows:<br />
<strong><em>jobid<!--_chainid-->_task</em>.def</strong><br />
This file will be used by the ReRun Job option.</dd>

<dt><strong>Task.def files</strong></dt>
<dd>If the <strong><tt>Save&amp;Restore</tt></strong> option on a task interface is used
to <tt>Save</tt> a <tt>Current Task Default</tt>, a file called <em>taskname.def</em>
will be saved in the database directory. This file will be used to initialise
the parameters whenever that task interface is used.</dd>

<dt><strong>Archived files</strong></dt>
<dd>All archived files have the same name as the original file with the
extension .gz (assuming your system uses the <em>gzip</em> compress mechanism).
These files are accessed via the
<strong><tt>Delete/Archive Files</tt></strong> button.</dd>
</dl>

<table border="0">
<tr><td>
<a href="fileviewer.html" target="_self">
<img border="0" class="navbutton" src="../images/3Dnexttr.gif" alt="next button" /></a>
<a href="fileselect.html" target="_self">
<img border="0" class="navbutton" src="../images/3Dprevtr.gif" alt="previous button" /></a>
<a href="../index.html" target="_top">
<img border="0" class="navbutton" src="../images/3Dtoptr.gif" alt="top button" /></a>
</td></tr>
</table>

</body>
</html>
