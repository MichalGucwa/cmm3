<!doctype html public "-//w3c//dtd html 3.2//en">
<html>
<head>
<title>CCP4I Documentation for Programmers: Core Documentation</title>
<link rel="stylesheet" type="text/css" href="../../ccp4idocs.css" title="CCP4i" />
<meta name="GENERATOR" content="Mozilla/3.0Gold (X11; I; IRIX 6.2 IP22) [Netscape]" />
</head>
<body>
<H2>CCP4i Documentation for Programmers: Core Documentation</H2>
<H3>Contents</H3>
<h3>The Task Mode (src/task.tcl)</h3>
<a name="The_Task_Mode"><h3> The Task Mode </h3> 
<p>In task mode only one task window is visible - this is run with the command 'ccp4i -t taskname'  To run in this mode bin/ccp4i.tcl calls the task procedure in src/task.tcl  which does the necessary initialisation and opens the task window.<p>
<a name="task" ><h4><font color="#CC3333">task</font> <em>Initialisation to run CCP4i in task mode. </em></h4> 
<p><em>Argument list: None</em></p>
<h3>The Taskbrowser (src/taskbrowser.tcl)</h3>
<a name="The_Taskbrowser"><h3> The Taskbrowser </h3> 
<p>The taskbrowser.tcl file contains procedures which are specific for running the ccp4i task browser (i.e. the usual way to run ccp4i). This file has a list of the other files which must be sourced and the procedure taskbrowser which is called from the startup bin/ccp4i.tcl<p>
<a name="taskbrowser" ><h4><font color="#CC3333">taskbrowser</font> <em>Initialise CCP4i to run the taskbrowser</em></h4> 
<p><em>Argument list: None</em></p>
<h3>Utilities for CCP4i Main Window (src/browser_utils.tcl)</h3>
<p>Some utilities for CCP4i run in 'browser' i.e. normal graphical mode.<p>
<a name="update_module_menu" ><h4><font color="#CC3333">update_module_menu</font> <em>Populate the menu of available modules</em></h4> 
<p><em>Argument list:  &lt;m&gt; &lt;arrayname&gt;</em></p>
<a name="update_module_menu" ><h4><font color="#CC3333">update_module_menu</font> <em>This creates entries in a menu corresponding to the modules loaded in to a data structure. Any existing entries are first deleted from the menu.</em></h4> 
<p><em>Argument list:  &lt;m&gt; &lt;arrayname&gt;</em></p>
<p><strong>m</strong>  Name of the widget with the menu<p>
<p><strong>arrayname</strong>  Name of the array with the data structure (usually called moduledef)<p>
<a name="GetTaskFile" ><h4><font color="#CC3333">GetTaskFile</font> <em>Get the Tcl file associated with a task</em></h4> 
<p><em>Argument list:  &lt;taskname&gt;</em></p>
<p>This command looks up the name of the Tcl file that is associated with a taskname, and returns the full path to the task file (or a blank string if no Tcl is found).<p>
<p><strong>taskname</strong>  The name of the task for which the task file is required<p>
<a name="GetRunCmd" ><h4><font color="#CC3333">GetRunCmd</font> <em>Return the command for running a task</em></h4> 
<p><em>Argument list:  &lt;taskname&gt; &lt;title&gt; &lt;&gt;</em></p>
<p>Given the name of a task, return the command that should be executed to launch that task. The procedure checks that the task has an associated Tcl file, and if this is not found goes on to check whether the task is actually a utility program.<p>
<p>If the taskname does reference either a valid task or a valid utility then this command returns an empty string.<p>
<p><strong>taskname</strong>  The name of the task to get the command for<p>
<p><strong>title</strong>  (Optional) A title to be used for utilities<p>
<a name="ReadTaskList" ><h4><font color="#CC3333">ReadTaskList</font> <em>Read the etc/$OPSYS/modules and $USER/.CCP4/$OPSYS/modules files </em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;filnam&gt;</em></p>
<p>Load the list of modules and tasks into the moduledef array<p>
<p>Modules and tasks are first loaded from the main CCP4i modules file and additional modules and/tasks are then read from the user's personal modules file (if it exists) and are appended to those already loaded.<p>
<p>ASIDE (1): The user's .CCP4 area has subdirectories unix/windows where modules files are stored - in the main CCP4i area these directories are UNIX/WINDOWS.<p>
<p>ASIDE (2): There is currently an issue that the 'internal' name of a task which is used for task file names etc. is also the task name seen by the user in the job list.  It would be better if the modules file had a separate definition of the 'user visible' task name.<p>
<p><strong>filnam</strong>  Name of the 'modules file<p>
<p><strong>arrayname</strong>  Name of array to contain data (usually moduledef)<p>
<a name="UpdateModulesList" ><h4><font color="#CC3333">UpdateModulesList</font> <em>Update the lists of modules and tasks</em></h4> 
<p><em>Argument list:  &lt;modulesname&gt; &lt;arrayname&gt;</em></p>
<p>To be filled in by pjx<p>
<p><strong>modulesname</strong>  Name of the array initialise from the modules.def file<p>
<p><strong>arrayname</strong>  Name of array to contain data (usually moduledef)<p>
<a name="CreateTaskBrowser" ><h4><font color="#CC3333">CreateTaskBrowser</font> <em>Draw the main graphical window of ccp4i</em></h4> 
<p><em>Argument list:  &lt;input_project&gt; &lt;input_title&gt; &lt;window&gt; &lt;arrayname&gt;</em></p>
<p><strong>input_project</strong>  Name of input project - used in window title<p>
<p><strong>input_title</strong>  Additional input title used in communication dialog box<p>
<p><strong>window</strong>  The Tk window id<p>
<p><strong>arrayname</strong>  The module/task array (usually called moduledef)<p>
<a name="module_help" ><h4><font color="#CC3333">module_help</font> <em>Handle user clicking for help on the Module menu</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt;</em></p>
<p>Go to the help page for the currently open module<p>
<a name="update_module" ><h4><font color="#CC3333">update_module</font> <em>Update task menu when user changes modules</em></h4> 
<p><em>Argument list:  &lt;selection&gt; &lt;arrayname&gt;</em></p>
<p><strong>selection</strong>  New module<p>
<p><strong>arrayname</strong>  The module/task array (usually called moduledef)<p>
<a name="open_module_folder" ><h4><font color="#CC3333">open_module_folder</font> <em>Open a module folder by (re)packing it</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;module&gt; &lt;name&gt; &lt;frame&gt; &lt;container&gt; &lt;folder&gt;</em></p>
<p><strong>arrayname</strong>  The module/task array (usually called moduledef)<p>
<p><strong>module</strong>  The current module holding the folder<p>
<p><strong>name</strong>  The name of the folder<p>
<p><strong>frame</strong>  The containing frame widget name<p>
<p><strong>container</strong>  The widget containing the title bar<p>
<p><strong>folder</strong>  The frame widget holding the list of tasks in the folder<p>
<a name="close_module_folder" ><h4><font color="#CC3333">close_module_folder</font> <em>Collapse a module folder by unpacking it</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;module&gt; &lt;name&gt; &lt;frame&gt; &lt;container&gt; &lt;folder&gt;</em></p>
<p><strong>arrayname</strong>  The module/task array (usually called moduledef)<p>
<p><strong>module</strong>  The current module holding the folder<p>
<p><strong>name</strong>  The name of the folder<p>
<p><strong>frame</strong>  The containing frame widget name<p>
<p><strong>container</strong>  The widget containing the title bar<p>
<p><strong>folder</strong>  The frame widget holding the list of tasks in the folder<p>
<a name="update_module_scroll" ><h4><font color="#CC3333">update_module_scroll</font> <em>Update the scrolling region of the tasklist</em></h4> 
<p><em>Argument list:  &lt;frame&gt;</em></p>
<p>When the tasklist is redrawn e.g. after  and reposition the view<p>
<p><strong>frame</strong>  The containing frame widget name<p>
<a name="check_task_prereq" ><h4><font color="#CC3333">check_task_prereq</font> <em>Check for prerequisites for a task</em></h4> 
<p><em>Argument list:  &lt;taskname&gt; &lt;taskfile&gt;</em></p>
<p>When building the task list, check each task file for a procedure called taskname_prereq, and if it is found then execute it. The procedure should return 1 if the task can be run and 0 if not.<p>
<p>The task interface author should code the necessary checks (for example, ensuring that required program executables are available on the user's path) into the taskname_prereq procedure.<p>
<p><strong>taskname</strong>  The name of the task<p>
<p><strong>taskfile</strong>  The full path of the task file for this interface<p>
<a name="MailHandler" ><h4><font color="#CC3333">MailHandler</font> <em>Create mail window for interface</em></h4> 
<p><em>Argument list: None</em></p>
<p>For Unix systems, calls the MailtoDev procedure to produce the mailer window. On Windows, starts up a browser pointing to the CCP4 on-line help page (www.ccp4.ac.uk/reportaprob.html)<p>
<a name="MailtoDev" ><h4><font color="#CC3333">MailtoDev</font> <em>Define the 'Mail CCP4' dialog box</em></h4> 
<p><em>Argument list: None</em></p>
<p>Calls the send_mail procedure to handle 'Send Mail' command<p>
<p>Mail utility - based on the Disguise (CCP11) interface mailtool<p>
<a name="send_mail" ><h4><font color="#CC3333">send_mail</font> <em>Handler for MailtoDev 'Send Mail' command</em></h4> 
<p><em>Argument list:  &lt;w&gt;</em></p>
<p>Extract text and recipient from the 'Mail CCP4' dialog box Use the generic SendMail procedure to send the mail<p>
<a name="SwitchProject" ><h4><font color="#CC3333">SwitchProject</font> <em>Switch the main window to another project</em></h4> 
<p><em>Argument list:  &lt;project&gt; &lt;menupath&gt;</em></p>
<p>Changes to the project selected by the user from the menu and updates the menu contents.<p>
<p><strong>project</strong>  Alias of the selected project<p>
<p><strong>menupath</strong>  Path of the change project button widget<p>
<a name="build_project_shortcut_menu" ><h4><font color="#CC3333">build_project_shortcut_menu</font> <em>Build the menu of project shortcuts on the main window</em></h4> 
<p><em>Argument list:  &lt;project&gt; &lt;menupath&gt;</em></p>
<p><strong>project</strong>  is the name of the current project<p>
<p><strong>menupath</strong>  is the path of the menu being updated<p>
<a name="ReloadTasklists" ><h4><font color="#CC3333">ReloadTasklists</font> <em>Reload the data for the modules and tasklists, and redraw</em></h4> 
<p><em>Argument list:  &lt;m&gt; &lt;arrayname&gt;</em></p>
<p><strong>m</strong>  Name of the menu widget (typically .module.menu.module.mb.m)<p>
<p><strong>arrayname</strong>  Name of the array holding the tasklist data (typically moduledef)<p>
</body>
</html>

