<!doctype html public "-//w3c//dtd html 3.2//en">
<html>
<head>
<title>CCP4I Documentation for Programmers: Core Documentation</title>
<link rel="stylesheet" type="text/css" href="../../ccp4idocs.css" title="CCP4i" />
<meta name="GENERATOR" content="Mozilla/3.0Gold (X11; I; IRIX 6.2 IP22) [Netscape]" />
</head>
<body>
<H2>CCP4i Documentation for Programmers: Core Documentation</H2>
<H3>Contents</H3>
<h3>File Viewer (src/fileviewer.tcl)</h3>
<a name="File_Viewer"><h3> File Viewer </h3> 
<p>The procedures in the file src/fileselect.tcl are concerned with display of files.  A procedure to display a specific file type such as LOG is called LOGViewer.<p>
<a name="fileviewer" ><h4><font color="#CC3333">fileviewer</font> <em>Setup procedure called if file viewer is run stand-alone</em></h4> 
<p><em>Argument list: None</em></p>
<p>The name of file to display is  passed from ccp4i script as system(SCRIPT)<p>
<a name="ExitFileViewer" ><h4><font color="#CC3333">ExitFileViewer</font> <em>Called on exiting file viewer - will terminate process in stand-alone mode</em></h4> 
<p><em>Argument list: None</em></p>
<a name="FileViewer" ><h4><font color="#CC3333">FileViewer</font> <em>Display a file </em></h4> 
<p><em>Argument list:  &lt;file&gt; &lt;args&gt;</em></p>
<a href=../../../help/programmers/FileViewer.html>See Programmers Documentation</a><a name="fileviewer0" ><h4><font color="#CC3333">fileviewer0</font> <em>Display a file</em></h4> 
<p><em>Argument list:  &lt;file&gt; &lt;format&gt; &lt;ANY&gt; &lt;viewer&gt;</em></p>
<p>The type of viewer to use is determined from the input parameters in order of preference: the specified viewer, the default viewer for the file type, the default viewer for the file type that is inferred from the file extension.  If the file type can not be inferred then the file will be displayed as a text file.<p>
<p><strong>file</strong>  Name of file to display<p>
<p><strong>format</strong>  (Optional) The file format - should correspond to a file format defined in etc/types.def<p>
<p><strong>viewer</strong>  The viewer to use to display the file.<p>
<a name="LOGViewer" ><h4><font color="#CC3333">LOGViewer</font> <em> Display a log file</em></h4> 
<p><em>Argument list:  &lt;filename&gt; &lt;args&gt;</em></p>
<p>The first few lines of file are read for an indication that the file is html.  If it is then it is displayed in Netscape.<p>
<p><strong>filename</strong>  Name of log file to display<p>
<p><strong>-summary</strong><p>
<p>Display only the summary from the log file.  Note that in the non-html display there is an option to toggle between full and summary display.<p>
<a name="LogGraph_graph" ><h4><font color="#CC3333">LogGraph_graph</font> <em>Use loggraph to display data from a 'graph' file</em></h4> 
<p><em>Argument list:  &lt;filename&gt;</em></p>
<p><strong>filename</strong>  Name of graph file to display<p>
<a name="LogGraph" ><h4><font color="#CC3333">LogGraph</font> <em>Display files using ccp4i loggraph</em></h4> 
<p><em>Argument list:  &lt;filename&gt; &lt;args&gt;</em></p>
<p><strong>filename</strong>  Name of file to display<p>
<p><strong>-format</strong><em>  format</em><p>
<p>Specify format of input file: should be LOG or GRAPH (default LOG)<p>
<a name="PDBViewer" ><h4><font color="#CC3333">PDBViewer</font> <em>Display PDB file as text</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of file to display<p>
<a name="MAPViewer" ><h4><font color="#CC3333">MAPViewer</font> <em>Use mapdump to read map header and display this</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>filename</strong>  Name of file to display<p>
<a name="MTZViewer" ><h4><font color="#CC3333">MTZViewer</font> <em>Use mtzdump to read mtz header and display this</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>filename</strong>  Name of file to display<p>
<a name="mtzviewer_info" ><h4><font color="#CC3333">mtzviewer_info</font> <em>pass-thru to set up new global array</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt;</em></p>
<a name="mtzviewer_info0" ><h4><font color="#CC3333">mtzviewer_info0</font> <em>Handle option for Extra Information when displaying MTZ files</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;mtz_arrayname&gt;</em></p>
<p>mtz_info behaves like a usual task interface - this procedure creates a 'mtz_info' task window<p>
<p><strong>arrayname</strong>  Name of array for fileviewer interface parameters<p>
<p><strong>mtz_arrayname</strong>  Name of array for mtz_info interface parameters<p>
<a name="mtzviewer_info_handler" ><h4><font color="#CC3333">mtzviewer_info_handler</font> <em>Handle the 'Run' command for mtz_info - Run mtzdmp or sftools</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;mtz_arrayname&gt;</em></p>
<p><strong>arrayname</strong>  Name of array for fileviewer interface parameters<p>
<p><strong>mtz_arrayname</strong>  Name of array for mtz_info interface parameters<p>
<a name="mtz_info_review" ><h4><font color="#CC3333">mtz_info_review</font> <em>Review and display the output from the mtz_info task</em></h4> 
<p><em>Argument list:  &lt;mtz_arrayname&gt; &lt;job_id&gt;</em></p>
<p> This procedure is called automatically after the mtz_info job has finished when been run by 'run_command'<p>
<p><strong>mtz_arrayname</strong>  Name of array for mtz_info interface parameters<p>
<p><strong>job_id</strong>  Job id for the mtz_info job which has just completed<p>
<a name="PSViewer" ><h4><font color="#CC3333">PSViewer</font> <em>Display a postscript file</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of PostScript file<p>
<a name="XMGRViewer" ><h4><font color="#CC3333">XMGRViewer</font> <em>Display xmgr file - as output by scala</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Input xmgr file<p>
<a name="PLOT84Viewer" ><h4><font color="#CC3333">PLOT84Viewer</font> <em>Use xplot84driver to display a plot84 file</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of plot84 file<p>
<a name="PLOT84PSViewer" ><h4><font color="#CC3333">PLOT84PSViewer</font> <em>Convert plot84 format file to PostScript and display with PSViewer</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of plot84 file<p>
<a name="MRViewer" ><h4><font color="#CC3333">MRViewer</font> <em>Display (and edit) a mr (molecular replacement) file</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of mr file<p>
<a name="HAViewer" ><h4><font color="#CC3333">HAViewer</font> <em>Display (and edit) a ha (heavy atom) file</em></h4> 
<p><em>Argument list:  &lt;file&gt;</em></p>
<p><strong>file</strong>  Name of ha file<p>
<a name="mr_ha_viewer" ><h4><font color="#CC3333">mr_ha_viewer</font> <em>Pass-thru to mr_edit task which will display & edit mr and ha files</em></h4> 
<p><em>Argument list:  &lt;file&gt; &lt;mode&gt;</em></p>
<p><strong>file</strong>  Name of mr/ha file<p>
<p><strong>mode</strong>  File mode - ha or mr<p>
<a name="RunRasMol" ><h4><font color="#CC3333">RunRasMol</font> <em>Run RasMol to display coordinates</em></h4> 
<p><em>Argument list:  &lt;filename&gt;</em></p>
<p><strong>filename</strong>  Input PDB coordinate file<p>
<a name="RunPyMol" ><h4><font color="#CC3333">RunPyMol</font> <em>Run PyMol lto display coordinates</em></h4> 
<p><em>Argument list:  &lt;filename&gt;</em></p>
<p><strong>filename</strong>  Input PDB coordinate file<p>
<a name="RunMapslicer" ><h4><font color="#CC3333">RunMapslicer</font> <em>Run the mapslicer program</em></h4> 
<p><em>Argument list:  &lt;filename&gt;</em></p>
<p><strong>filename</strong>  Input CCP4 format map file<p>
<a name="RunCoot" ><h4><font color="#CC3333">RunCoot</font> <em>Run the Coot program</em></h4> 
<p><em>Argument list:  &lt;args&gt;</em></p>
<p><strong>Command</strong>  line arguments to be passed directly to Coot<p>
<a name="RunCCP4mg" ><h4><font color="#CC3333">RunCCP4mg</font> <em>Run the CCP4mg program</em></h4> 
<p><em>Argument list:  &lt;args&gt;</em></p>
<p><strong>Command</strong>  line arguments to be passed directly to CCP4mg<p>
<a name="RunDbviewer" ><h4><font color="#CC3333">RunDbviewer</font> <em>Launch the Dbviewer application</em></h4> 
<p><em>Argument list:  &lt;args&gt;</em></p>
<p><strong>Command</strong>  line arguments to be passed directly to DbViewer<p>
<a name="DisplayTextFile" ><h4><font color="#CC3333">DisplayTextFile</font> <em>Display a text file</em></h4> 
<p><em>Argument list:  &lt;filename&gt; &lt;args&gt;</em></p>
<a href=../../../help/programmers/DisplayTextFile.html></a><a name="LoadTextWindow" ><h4><font color="#CC3333">LoadTextWindow</font> <em>Load the text into the window set up by DisplayTextFile</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;text_list&gt; &lt;args&gt;</em></p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>text_list</strong>  The text to insert - may be in the form of a list.<p>
<p><strong>-append</strong><p>
<p>Append new text to any test already in the window<p>
<a name="display_next_frame" ><h4><font color="#CC3333">display_next_frame</font> <em>handle the display of the next frame of text if displaying a very large file</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;w&gt; &lt;increment&gt; &lt;1&gt;</em></p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>w</strong>  Window id for file display interface<p>
<p><strong>increment</strong><p>
<p>Number of frames to move on from the current frame (default is 1). Increment can be negative, to go to previous frames<p>
<a name="display_read_frame" ><h4><font color="#CC3333">display_read_frame</font> <em>Read a frame from a log file into memory so it can be displayed</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt;</em></p>
<p>Internal procedure called by display_next_frame. Returns the number of the current frame.<p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<a name="display_skip_frame" ><h4><font color="#CC3333">display_skip_frame</font> <em>Read through a frame from a log file and discard it</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt;</em></p>
<p>Called by display_next_frame. Returns the number of the current frame.<p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<a name="display_text_update_case" ><h4><font color="#CC3333">display_text_update_case</font> <em>Handle user changing the respect/ignore case option</em></h4> 
<p><em>Argument list:  &lt;field&gt; &lt;arrayname&gt; &lt;w&gt;</em></p>
<p><strong>field</strong>  The user selection ignore or respect<p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>w</strong>  Window id for file display interface<p>
<a name="display_text_close" ><h4><font color="#CC3333">display_text_close</font> <em>Handle user clicking Close button.</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;w&gt;</em></p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>w</strong>  Window id for file display interface<p>
<a name="display_text_save" ><h4><font color="#CC3333">display_text_save</font> <em>Handle user opting to save contents when using 'edit' mode</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;filename&gt;</em></p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>filename</strong>  Name of file to save text to<p>
<a name="display_text_find" ><h4><font color="#CC3333">display_text_find</font> <em>Handle user hitting Find or 'Close Find' button</em></h4> 
<p><em>Argument list:  &lt;mode&gt; &lt;w&gt; &lt;arrayname&gt;</em></p>
<p><strong>mode</strong>  open or close<p>
<p><strong>w</strong>  The Tk id for the window<p>
<p><strong>arrayname</strong>  Name of data array<p>
<a name="display_text_find_string" ><h4><font color="#CC3333">display_text_find_string</font> <em>Find and highlight given string in the text</em></h4> 
<p><em>Argument list:  &lt;mode&gt; &lt;arrayname&gt; &lt;args&gt;</em></p>
<p><strong>mode</strong>  Mode of action: next= Just move to next instance of the search string previous= Just move to previous instance of the search string hilight= Just highlight the instances of the search string update= Search the text for the search string, highlight hits<p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>-position</strong><em>  position</em><p>
<p>In update mode do search from position (used when file is still been read in)<p>
<a name="display_links" ><h4><font color="#CC3333">display_links</font> <em> Dispaly links in log file</em></h4> 
<p><em>Argument list:  &lt;arrayname&gt; &lt;w&gt;</em></p>
<p>This is not used and may not be fully functional<p>
<a name="MonitorFile" ><h4><font color="#CC3333">MonitorFile</font> <em>Read and display a file that is still being written</em></h4> 
<p><em>Argument list:  &lt;w&gt; &lt;arrayname&gt; &lt;file&gt; &lt;mtime&gt; &lt;size&gt; &lt;delay&gt; &lt;terminator&gt;</em></p>
<p>This procedure works by re-calling itself after a small time delay. If the file is not increasing in size then the time delay is increased. The procedure searches the file for some specified text string which indicates the file is complete and then MonitorFile will stop re-calling itself.<p>
<p><strong>w</strong>  Tk id of the text window<p>
<p><strong>arrayname</strong>  Array for file display interface<p>
<p><strong>file</strong>  Name of file to display<p>
<p><strong>mtime</strong>  The time at which file was last modified (a negative value signifies the first call to MonitorFile<p>
<p><strong>size</strong>  The size of the file when last modified<p>
<p><strong>delay</strong>  The delay before re-calling MonitorFile<p>
<p><strong>terminator</strong>  A text string whose presence in the file would indicate the end of the file<p>
<a name="display_text_summary" ><h4><font color="#CC3333">display_text_summary</font> <em>Handle the 'Show Summary' option</em></h4> 
<p><em>Argument list:  &lt;w&gt; &lt;arrayname&gt;</em></p>
<p><strong>w</strong>  Display text interface window id<p>
<p><strong>arrayname</strong>  Name of display text interface array<p>
<a name="display_text_full" ><h4><font color="#CC3333">display_text_full</font> <em>Handle the 'Show Full Text' option</em></h4> 
<p><em>Argument list:  &lt;w&gt; &lt;arrayname&gt;</em></p>
<p><strong>w</strong>  Display text interface window id<p>
<p><strong>arrayname</strong>  Name of display text interface array<p>
<a name="ExtractLogSummary" ><h4><font color="#CC3333">ExtractLogSummary</font> <em>Extract the text tagged as 'summary' from a log file</em></h4> 
<p><em>Argument list:  &lt;fullText&gt; &lt;summaryTextVar&gt;</em></p>
<p><strong>fullText</strong>  Input the full text<p>
<p><strong>summaryTextVar</strong>  Output the text summary<p>
<a name="HilightLogSummary" ><h4><font color="#CC3333">HilightLogSummary</font> <em>Highlight the sections of log file which are tagged as 'summary'</em></h4> 
<p><em>Argument list:  &lt;fullText&gt;</em></p>
<p><strong>fullText</strong>  Input the full text<p>
<a name="GetViewerList" ><h4><font color="#CC3333">GetViewerList</font> <em>Extract the list of file formats, viewers and full viewer commands from the typedef array</em></h4> 
<p><em>Argument list:  &lt;format&gt; &lt;viewerVar&gt; &lt;viewercmdVar&gt;</em></p>
<p>The definitions have been read from the etc/types.def file into the typedef array.  This procedure reformats the information as lists which are easier to handle.<p>
<p><strong>format</strong>  Output list of supported file formats<p>
<p><strong>viewer</strong>  Output list of viewer names (corresponding to format list) which is the name of the viewer as seen by the user<p>
<p><strong>viewercmd</strong>  Output list of the commands required to run viewers (corresponding to format and viewer lists)<p>
<h3>Plugin Utilities (src/plugins.tcl)</h3>
<a name="Plugin_Utilities"><h3> Plugin Utilities </h3> 
<p>The procedures in this file provide support for a simple "plugins" mechanism within CCP4i. A "plugin" is another application outside of CCP4i which can be usefully invoked on behalf of the user to view files or perform a new action after a particular task has been run. For example, after a run of Refmac5 it might be useful to launch Coot to further work on the refined structure.<p>
<p>Data about which plugins are available for which task is stored in the ccp4i_plugins global array. Elements of the array are tasknames; the value of each element is a list of plugin names. For each plugin there should be a procedure called plugin_for_$pluginname, which returns a text string and a command for launching the application given the taskname and a list of files output from that task.<p>
<p>The GetPlugins procedure provides an interface to the available plugins: given a taskname and list of files, it returns the available plugin commands that could be invoked.<p>
<a name="GetPlugins" ><h4><font color="#CC3333">GetPlugins</font> <em>Return available plugins for a specific task</em></h4> 
<p><em>Argument list:  &lt;taskname&gt; &lt;filelist&gt;</em></p>
<p>Given the name of a task plus a list of associated files, this command checks whether any plugins have been specified for that task and attempts to generate commands for launching any that are found.<p>
<p>The result of the command is a list of plugin specifications. Each specification is also a list, the first element being a string of text to be displayed in (e.g.) the "View Files from Job" menu, and the other the command to be invoked to start the plugin application.<p>
<p>If no plugins are found then an empty list is returned.<p>
<p><strong>taskname</strong>  Name of the task<p>
<p><strong>filelist</strong>  List of full filenames output from the task<p>
<a name="get_plugin_executable" ><h4><font color="#CC3333">get_plugin_executable</font> <em>Helper function: verify and return the executable name</em></h4> 
<p><em>Argument list:  &lt;program&gt; &lt;execVar&gt;</em></p>
<p>This command wraps FindExecutable. It returns 1 if the specified executable is found, and the executable path is returned in the specified variable. Otherwise it returns 0.<p>
<p><strong>program</strong>  Name of the program executable to be found<p>
<p><strong>execVar</strong>  Name of the variable to return the name in, if found<p>
<h3>Plugin Command Generation Functions</h3>
<a name="Plugin_Command_Generation_Functions"><h3> Plugin Command Generation Functions </h3> 
<p>The functions in this section generate the appropriate commands for launching the plugin applications for specified task contexts and available output files.<p>
<p>Each plugin should have an associated plugin_for_* procedure defined, which should take exactly two arguments: the first is the name of a task, and the second is a list of files from a job. The procedure should contain code specific to the plugin application, and return a list of two elements - the first is a string of text that describes the operation of the plugin when launched, and the second is the actual command to launch the plugin in background.<p>
<p>If no plugin is available then an empty list should be returned.<p>
<p><strong>taskname</strong>  Name of the task<p>
<p><strong>filelist</strong>  List of files output from a run of the task<p>
<p><strong>taskname</strong>  Name of the task<p>
<p><strong>filelist</strong>  List of files output from a run of the task<p>
<p><strong>taskname</strong>  Name of the task<p>
<p><strong>filelist</strong>  List of files output from a run of the task<p>
</body>
</html>

